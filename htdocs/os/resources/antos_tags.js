riot.tag2("afx-app-window",'<div class="afx-window-wrapper"> <ul class="afx-window-top"> <li class="afx-window-close" onclick="{close}"></li> <li if="{minimizable == true}" class="afx-window-minimize" onclick="{minimize}"></li> <li if="{resizable == true}" class="afx-window-maximize" onclick="{maximize}"></li> <li ref="dragger" class="afx-window-title">{apptitle?apptitle.__():apptitle}</li> </ul> <div class="afx-clear"></div> <div ref="content" class="afx-window-content"> <yield></yield> </div> <div if="{resizable == true}" ref="grip" class="afx-window-grip"> </div>',"",'ref="window"',function(opts){this.apptitle=opts.apptitle||"",null==opts.minimizable?this.minimizable=!0:this.minimizable=eval(opts.minimizable),null==opts.resizable?this.resizable=!0:this.resizable=eval(opts.resizable);var self=this,offset={top:0,left:0},desktop_pos=$("#desktop").offset(),isMaxi=!1,history={},width=opts.width||400,height=opts.height||300;this.root.observable=opts.observable||riot.observable(),window._zindex||(window._zindex=10),this.shown=!1,self.root.contextmenuHandler=function(e){},self.root.set=function(e,t){if("*"==e)for(var o in t)self[o]=t[o];else self[e]=t;"apptitle"==e&&self.root.observable.trigger("apptitlechange"),self.update()},self.root.get=function(e){return self[e]},self.root.update=function(){self.update()},this.minimize=function(){this.root.observable.trigger("hide")}.bind(this),this.close=function(){this.root.observable.trigger("exit")}.bind(this),this.on("mount",function(){var e,t;e=($("#desktop").width()-width)/2,t=($("#desktop").height()-height)/2,$(self.refs.window).css("position","absolute").css("left",e+"px").css("top",t+"px").css("width",width+"px").css("height",height+"px").css("z-index",window._zindex++),$(self.refs.window).on("mousedown",function(e){0==self.shown&&self.root.observable.trigger("focus")}),$(self.refs.window).click(function(e){}),enable_dragging(),self.resizable&&enable_resize(),$(self.refs.dragger).dblclick(function(e){toggle_window()}),$(self.refs.content).children().each(function(e){this.observable=self.root.observable});var o=function(){var t=$(self.refs.content).height()/$(self.refs.content).children().length;$(self.refs.content).children().each(function(e){$(this).css("height",t+"px")})};o(),self.root.observable.on("resize",function(){o()}),self.root.observable.on("focus",function(){window._zindex++,$(self.refs.window).show().css("z-index",window._zindex).removeClass("unactive"),self.shown=!0}),self.root.observable.on("blur",function(){self.shown=!1,$(self.refs.window).addClass("unactive")}),self.root.observable.on("hide",function(){$(self.refs.window).hide(),self.shown=!1}),self.root.observable.on("toggle",function(){self.shown?self.root.observable.trigger("hide"):self.root.observable.trigger("focus")}),self.root.observable.trigger("rendered",self.root)});var enable_dragging=function(){$(self.refs.dragger).css("user-select","none").css("cursor","default"),$(self.refs.dragger).on("mousedown",function(e){e.preventDefault(),(offset=$(self.refs.window).offset()).top=e.clientY-offset.top,offset.left=e.clientX-offset.left,$(window).on("mousemove",function(e){var t,o;isMaxi?(toggle_window(),t=0,letf=e.clientX-$(self.refs.window).width()/2,offset.top=10,offset.left=$(self.refs.window).width()/2):(t=e.clientY-offset.top-desktop_pos.top,o=(o=e.clientX-desktop_pos.top-offset.left)<0?0:o,t=t<0?0:t),$(self.refs.window).css("top",t+"px").css("left",o+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},enable_resize=function(){self.resizable&&($(self.refs.grip).css("user-select","none").css("cursor","default").css("position","absolute").css("bottom","0").css("right","0").css("cursor","nwse-resize"),$(self.refs.grip).on("mousedown",function(e){e.preventDefault(),offset.top=e.clientY,offset.left=e.clientX,$(window).on("mousemove",function(e){var t,o;t=(t=$(self.refs.window).width()+e.clientX-offset.left)<100?100:t,o=(o=$(self.refs.window).height()+e.clientY-offset.top)<100?100:o,offset.top=e.clientY,offset.left=e.clientX,$(self.refs.window).css("width",t+"px").css("height",o+"px"),isMaxi=!1,self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:t,h:o})}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})}))},toggle_window=function(){var e,t;self.resizable&&(0==isMaxi?(history={top:$(self.refs.window).css("top"),left:$(self.refs.window).css("left"),width:$(self.refs.window).css("width"),height:$(self.refs.window).css("height")},e=$("#desktop").width()-5,t=$("#desktop").height()-10,$(self.refs.window).css("width",e+"px").css("height",t+"px").css("top","0").css("left","0"),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:e,h:t}),isMaxi=!0):(isMaxi=!1,$(self.refs.window).css("width",history.width).css("height",history.height).css("top",history.top).css("left",history.left),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:history.width,h:history.height})))};this.maximize=function(){toggle_window()}.bind(this)}),riot.tag2("afx-apps-dock",'<afx-button class="{selected: parent.selectedApp && it.app.pid == parent.selectedApp.pid}" each="{it,i in items}" iconclass="{it.iconclass}" icon="{it.icon}" appindex="{i}" text="{it.text}" onbtclick="{it.onbtclick}" tooltip="{⁗cr:⁗ + it.app.title()}"> </afx-button>',"","",function(e){this.items=e.items||[];var s=this;s.selectedApp=null,s.root.set=function(e,t){if("*"==e)for(var o in t)s[o]=t[o];else if(s[e]=t,"selectedApp"==e){for(var o in s.items)s.items[o].app.blur();t&&$("#desktop")[0].set("selected",-1)}s.update()},s.root.newapp=function(e){for(var e in s.items.push(e),s.selectedApp=e.app,s.update(),s.items)s.items[e].app.blur()},s.root.removeapp=function(e){var t=-1;for(var o in s.items)if(s.items[o].app.pid==e.pid){t=o;break}-1!=t&&(delete s.items[t].app,s.items.splice(t,1),s.update())},s.root.update=function(){s.update()},s.root.get=function(e){return s[e]},this.on("mount",function(){window.OS.courrier.trigger("sysdockloaded")}),s.root.contextmenuHandler=function(e,t){if(e.target!=s.root){var o=$(e.target).closest("afx-button").attr("appindex"),i=s.items[o].app;t.set("items",[{text:"__(Show)",dataid:"show"},{text:"__(Hide)",dataid:"hide"},{text:"__(Close)",dataid:"quit"}]),t.set("onmenuselect",function(e){i[e.item.data.dataid]&&i[e.item.data.dataid]()}),t.show(e)}}}),riot.tag2("afx-button",'<button disabled="{enable == ⁗false⁗}" onclick="{_onbtclick}" ref="mybtn"> <afx-label color="{color}" icon="{icon}" iconclass="{iconclass}" text="{text}"></afx-label> </button>',"","",function(opts){this.enable=opts.enable,this.icon=opts.icon,this.iconclass=opts.iconclass,this.color=opts.color,this.text=opts.text||"";var self=this;this.onbtclick=opts.onbtclick,self.root.set=function(e,t){if("*"==e)for(var o in t)self[o]=t[o];else self[e]=t;self.update()},self.root.trigger=function(){$(self.refs.mybtn).trigger("click")},self.root.get=function(e){return self[e]},this._onbtclick=function(e){"string"==typeof self.onbtclick?eval(self.onbtclick):self.onbtclick&&self.onbtclick(e),self.root.observable&&self.root.observable.trigger("btclick",{id:$(self.root).attr("data-id"),data:self.root})}}),riot.tag2("afx-calendar-view",'<div><i class="prevmonth" onclick="{prevmonth}"></i> <afx-label text="{mtext}"></afx-label> <afx-label text="{year}"></afx-label> <i onclick="{nextmonth}" class="nextmonth"></i></div> <afx-grid-view data-id="{⁗grid_⁗ + rid}" style="height:100%;" ref="grid" header="{header}"> </afx-grid-view>',"","",function(e){this.header=[{value:"__(Sun)"},{value:"__(Mon)"},{value:"__(Tue)"},{value:"__(Wed)"},{value:"__(Thu)"},{value:"__(Fri)"},{value:"__(Sat)"}],this.root.observable=e.observable;var a=this;this.day=0,this.month=0,this.year=0,this.ondayselect=e.ondayselect,this.rid=$(a.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.selectedDate=void 0,a.root.get=function(e){return a[e]},this.on("mount",function(e){a.refs.grid.root.observable=a.root.observable,t(null),a.root.observable.on("gridcellselect",function(e){if(e.id=="grid_"+a.rid&&""!=e.data.value){var t={id:a.rid,data:new Date(a.year,a.month,e.data.value)};a.ondayselect&&a.ondayselect(t),a.selectedDate=t.data,a.root.observable.trigger("dayselect",t)}})}),this.prevmonth=function(){a.selectedDate=void 0,this.month--,this.month<0&&(this.month=11,this.year--),t(new Date(this.year,this.month,1))}.bind(this),this.nextmonth=function(){a.selectedDate=void 0,this.month++,11<this.month&&(this.month=0,this.year++),t(new Date(this.year,this.month,1))}.bind(this);var t=function(e){null===e&&(e=new Date),a.day=e.getDate(),a.month=e.getMonth(),a.year=e.getFullYear();var t=(new Date).getDate(),o=(new Date).getMonth(),i=(new Date).getFullYear();months=["__(January)","__(February)","__(March)","__(April)","__(May)","__(June)","__(July)","__(August)","__(September)","__(October)","__(November)","__(December)"],this_month=new Date(a.year,a.month,1),next_month=new Date(a.year,a.month+1,1),first_week_day=this_month.getDay(),days_in_this_month=Math.round((next_month.getTime()-this_month.getTime())/864e5),a.mtext=months[a.month];var s=[],r=[];for(week_day=0;week_day<first_week_day;week_day++)r.push({value:""});for(week_day=first_week_day,day_counter=1;day_counter<=days_in_this_month;day_counter++)week_day%=7,0==week_day&&(s.push(r),r=[]),t==day_counter&&a.month==o&&a.year==i?r.push({value:day_counter,selected:!0}):r.push({value:day_counter}),week_day++;for(var n=0;n<=7-r.length;n++)r.push({value:""});s.push(r),a.refs.grid.root.set("rows",s)}}),riot.tag2("afx-color-picker",'<div style="width:310px; height:190px;display:block; padding:3px;"> <canvas class="color-palette" width="284" height="155" style="float:left;" ref="palette"></canvas> <div class="color-sample" style="width:15px; height:155px; text-align:center; margin-left:3px; display:block;float:left;" ref="colorval"></div> <div class="afx-clear"></div> <div style="margin-top:3px;"> <span>Hex:</span><input type="text" ref="hextext" style="width:70px; margin-left:3px;margin-right:5px;"></input> <span ref="rgbtext"></span> </div> </div>',"","",function(e){var n=this,a=void 0;n.root.observable=e.observable,n.oncolorsetect=e.oncolorsetect,n.selectedColor=void 0,n.root.set=function(e,t){if("*"==e)for(var o in t)n[o]=t[o];else n[e]=t;n.update()},n.root.get=function(e){return n[e]};this.on("mount",function(){!function(){var e=(a=$(n.refs.palette).get(0).getContext("2d")).createLinearGradient(0,0,$(n.refs.palette).width(),0);e.addColorStop(0,"rgb(255,   0,   0)"),e.addColorStop(.15,"rgb(255,   0, 255)"),e.addColorStop(.33,"rgb(0,     0, 255)"),e.addColorStop(.49,"rgb(0,   255, 255)"),e.addColorStop(.67,"rgb(0,   255,   0)"),e.addColorStop(.84,"rgb(255, 255,   0)"),e.addColorStop(1,"rgb(255,   0,   0)"),e.addColorStop(0,"rgb(0,   0,   0)"),a.fillStyle=e,a.fillRect(0,0,a.canvas.width,a.canvas.height),(e=a.createLinearGradient(0,0,0,$(n.refs.palette).width())).addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0,     0,   0, 0)"),e.addColorStop(1,"rgba(0,     0,   0, 1)"),a.fillStyle=e,a.fillRect(0,0,a.canvas.width,a.canvas.height);var r=function(e){return s=e.toString(16),1==s.length&&(s="0"+s),s},o=function(e){$(n.refs.palette).css("cursor","crosshair");var t=$(n.refs.palette).offset(),o=e.pageX-t.left,i=e.pageY-t.top,s=a.getImageData(o,i,1,1);return{r:s.data[0],g:s.data[1],b:s.data[2],text:"rgb("+s.data[0]+", "+s.data[1]+", "+s.data[2]+")",hex:"#"+r(s.data[0])+r(s.data[1])+r(s.data[2])}},t=function(e){var t=o(e);$(n.refs.colorval).css("background-color",t.text)};$(n.refs.palette).mouseenter(function(e){$(n.refs.palette).on("mousemove",t)}),$(n.refs.palette).mouseout(function(e){$(n.refs.palette).unbind("mousemove",t),n.selectedColor&&$(n.refs.colorval).css("background-color",n.selectedColor.text)}),$(n.refs.palette).on("click",function(e){data=o(e),$(n.refs.rgbtext).html(data.text),$(n.refs.hextext).val(data.hex),n.selectedColor=data,n.oncolorsetect&&n.oncolorsetect(data),n.root.observable&&n.root.observable.trigger("colorselect",data)})}()})}),riot.tag2("afx-dummy","<yield></yield>","","",function(e){var t=this;t.root.update=function(){t.update()}}),riot.tag2("afx-file-view",'<afx-list-view ref="listview" observable="{root.observable}"></afx-list-view> <afx-grid-view ref="gridview" header="{header}" observable="{root.observable}"></afx-grid-view> <div class="treecontainer" ref="treecontainer"> <afx-tree-view ref="treeview" observable="{root.observable}"></afx-tree-view> </div> <afx-label if="{status == true}" class="status" ref="stbar"></afx-label>',"","",function(e){var s=this;s.root.observable=e.observable||riot.observable(),s.view=e.view||"list",s.data=e.data||[],s.path=e.path||"home:///",s.onfileselect,s.onfileopen,this.status=null==e.status||e.status,this.selectedFile=void 0,this.showhidden=e.showhidden,this.preventUpdate=!1,this.fetch=e.fetch,this.chdir=e.chdir,this.rid=$(s.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.header=[{value:"__(File name)"},{value:"__(Type)",width:150},{value:"__(Size)",width:70}],s.root.set=function(e,t){if("*"==e)for(var o in t)s[o]=t[o];else s[e]=t;"view"==e&&n(),"data"==e&&(s.selectedFile=void 0),"preventUpdate"!=e&&s.update()},s.root.get=function(e){return s[e]};var t=function(e,t){return e.type<t.type?-1:e.type>t.type?1:0},o=function(){var e=$(s.root).outerHeight(),t=$(s.root).width();s.refs.stbar&&(e-=$(s.refs.stbar.root).height()+10),$(s.refs.listview.root).css("height",e+"px"),$(s.refs.gridview.root).css("height",e+"px"),$(s.refs.treecontainer).css("height",e+"px"),$(s.refs.listview.root).css("width",t+"px"),$(s.refs.gridview.root).css("width",t+"px"),$(s.refs.treecontainer).css("width",t+"px")},r=function(e){return nodes=[],$.each(e,function(e,t){("."!=t.filename[0]||s.showhidden)&&(t.name=t.filename,"dir"==t.type&&(t.nodes=[],t.open=!1),t.iconclass=t.iconclass?t.iconclass:t.type,t.icon=t.icon,nodes.push(t))}),nodes},i=function(){var i,o;s.data.sort(t),"icon"==s.view?(o=[],$.each(s.data,function(e,t){("."!=t.filename[0]||s.showhidden)&&(t.text=t.filename,10<t.text.length&&(t.text=t.text.substring(0,9)+"..."),t.iconclass=t.iconclass?t.iconclass:t.type,t.icon=t.icon,o.push(t))}),s.refs.listview.root.set("items",o)):"list"==s.view?(i=[],$.each(s.data,function(e,t){if("."!=t.filename[0]||s.showhidden){var o=[{value:t.filename,iconclass:t.iconclass?t.iconclass:t.type,icon:t.icon},{value:t.mime},{value:t.size},{idx:e}];i.push(o)}}),s.refs.gridview.root.set("rows",i)):function(){s.refs.treeview.root.set("selectedItem",null);var e={};e.name=s.path,e.nodes=r(s.data),s.refs.treeview.root.set("data",e)}()},n=function(){switch($(s.refs.listview.root).hide(),$(s.refs.gridview.root).hide(),$(s.refs.treecontainer).hide(),s.selectedFile=void 0,s.refs.listview.root.set("selected",-1),s.refs.treeview.selectedItem=void 0,s.refs.treeview.root.set("fetch",function(e,t){s.fetch&&s.fetch(e,function(e){t(r(e))})}),s.refs.stbar&&s.refs.stbar.root.set("text",""),s.view){case"icon":$(s.refs.listview.root).show();break;case"list":$(s.refs.gridview.root).show();break;case"tree":$(s.refs.treecontainer).show()}o()};s.on("updated",function(){s.preventUpdate?s.preventUpdate=!1:i()}),s.on("mount",function(){n(),s.refs.listview.onlistselect=function(e){e.id=s.rid,s.root.observable.trigger("fileselect",e)},s.refs.listview.onlistdbclick=function(e){e.id=s.rid,s.root.observable.trigger("filedbclick",e)},s.refs.gridview.root.observable=s.root.observable,s.refs.gridview.ongridselect=function(e){var t={id:s.rid,data:s.data[e.data.child[3].idx],idx:e.data.child[3].idx};s.root.observable.trigger("fileselect",t)},s.refs.gridview.ongriddbclick=function(e){var t={id:s.rid,data:s.data[e.data.child[3].idx],idx:e.data.child[3].idx};s.root.observable.trigger("filedbclick",t)},s.refs.treeview.ontreeselect=function(e){if(e){var t=e;0==e.treepath&&((t=s.path.asFileHandler()).size=0,t.filename=t.path);var o={id:s.rid,data:t};s.root.observable.trigger("fileselect",o)}},s.refs.treeview.ontreedbclick=function(e){if(e&&0!=e.treepath){var t={id:s.rid,data:e};s.root.observable.trigger("filedbclick",t)}},s.root.observable.on("fileselect",function(e){e.id==s.rid&&(s.selectedFile=e.data,s.onfileselect&&s.onfileselect(e.data),s.refs.stbar&&s.refs.stbar.root.set("text",__("Selected: {0} ({1} bytes)",e.data.filename,e.data.size?e.data.size:"0")))}),s.root.observable.on("filedbclick",function(e){e.id==s.rid&&("dir"!=e.data.type&&s.onfileopen?s.onfileopen(e.data):s.chdir&&"dir"==e.data.type&&s.chdir(e.data.path))}),o(),s.root.observable.on("resize",function(e){o()}),s.root.observable.on("calibrate",function(e){o()})})}),riot.tag2("afx-float-list",'<div ref="list"> <div each="{item,i in items}" class="{float_list_item:true, float_list_item_selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onmousedown="{parent._select}" oncontextmenu="{parent._select}"> <afx-label color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> </div> </div>',"",'ref="container"',function(e){this.items=e.items||[];var a=this;a.selidx=-1,a.onlistselect=e.onlistselect,a.onlistdbclick=e.onlistdbclick,a.fetch=void 0,this.root.observable=e.observable||riot.observable(),this.rid=$(a.root).attr("data-id")||Math.floor(1e5*Math.random())+1,a.dir=e.dir||"horizontal",a.root.set=function(e,t){if("selected"==e)-1!=a.selidx&&(a.items[a.selidx].selected=!1),-1==t?a.selidx=-1:a.items[t]&&(a.items[t].selected=!0);else if("*"==e)for(var o in t)a[o]=t[o];else a[e]=t;a.update()},a.root.get=function(e){return"selected"==e?-1==a.selidx?void 0:a.items[a.selidx]:a[e]},a.root.push=function(e,t){a.items.push(e),t&&a.update()},a.root.unshift=function(e,t){a.items.unshift(e),t&&a.update()},a.root.remove=function(e,t){var o=a.items.indexOf(e);0<=o&&(-1!=a.selidx&&(a.items[a.selidx].selected=!1,a.selidx=-1),a.items.splice(o,1),t&&a.update())},a.root.refresh=function(){t()},this.on("mount",function(){a.root.ready&&a.root.ready(a.root),t()});var t=function(){var i=20,s=20,r=$(a.refs.container).width(),n=$(a.refs.container).height();$(a.refs.list).children().each(function(e){$(this).unbind("mousedown"),l($(this));var t=$(this).width(),o=$(this).height();$(this).css("top",i+"px").css("left",s+"px"),"horizontal"==a.dir?n<(i+=o+20)&&(s+=t+(i=20)):r<(s+=t+20)&&(i+=o+(s=20))})},l=function(i){var s=$(a.refs.container).offset();i.css("user-select","none").css("cursor","default").css("position","absolute").on("mousedown",function(e){e.preventDefault(),offset=i.offset(),offset.top=e.clientY-offset.top,offset.left=e.clientX-offset.left,$(window).on("mousemove",function(e){var t,o;t=e.clientY-offset.top-s.top,o=(o=e.clientX-s.top-offset.left)<0?0:o,t=t<0?0:t,i.css("top",t+"px").css("left",o+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})};this._autoselect=function(e,t){if(a.selidx==t)return!0;if(!e.selected||0==e.selected)return!1;var o={id:a.rid,data:e,idx:t};return a.selidx=t,a.onlistselect&&a.onlistselect(o),this.root.observable.trigger("listselect",o),!0}.bind(this),this._select=function(e){-1!=a.selidx&&a.selidx<a.items.length&&(a.items[a.selidx].selected=!1),e.item.item.selected=!0,a.update()}.bind(this),this._dbclick=function(e){data={id:a.rid,data:e.item.item,idx:e.item.i},a.onlistdbclick&&a.onlistdbclick(data),a.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-grid-view",'<afx-grid-row ref="gridhead" rootid="{rid}" observable="{root.observable}" header="true" class="{grid_row_header:header}" if="{header}" cols="{header}"> </afx-grid-row> <div ref="scroller" style="width:100%; overflow:auto;"> <div ref="container" style="padding-bottom:10px"> <afx-grid-row each="{child, i in rows}" class="{selected: child.selected}" rootid="{parent.rid}" observable="{parent.root.observable}" index="{i}" cols="{child}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}" head="{parent.refs.gridhead}"></afx-grid-row> </div> </div>',"","",function(e){this.header=e.header,this.rows=e.rows||[];var i=this;this.rid=$(i.root).attr("data-id")||Math.floor(1e5*Math.random())+1,i.selidx=-1,i.nrow=0,i.ongridselect=e.ongridselect,i.ongriddbclick=e.ongriddbclick,i.root.observable=e.observable,i.root.set=function(e,t){if("selected"==e)i._select({item:i.rows[t],preventDefault:function(){}});else if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;i.update()},this.calibrate_size=function(){i.header&&i.refs.gridhead?$(i.refs.scroller).css("height",$(i.root).height()-$(i.refs.gridhead.root).children().first().height()+"px"):$(i.refs.scroller).css("height",$(i.root).height()+"px")},i.root.get=function(e){return"selected"==e?-1==i.selidx?null:i.rows[i.selidx]:i[e]},this.on("mount",function(){i.refs.gridhead&&(i.refs.gridhead.observable=i.root.observable),$(i.refs.container).css("display","table").css("width","100%"),i.calibrate_size(),i.root.observable.on("resize",function(){i.root&&i.calibrate_size()})}),this.on("updated",function(){i.selidx>=i.rows.length&&(i.selidx=-1),i.nrow!=i.rows.length&&(i.nrow=i.rows.length,i.calibrate_size())}),this._select=function(e){var t={id:i.rid,data:e.item};i.ongridselect&&i.ongridselect(t),-1!=i.selidx&&(i.rows[i.selidx].selected=!1),i.selidx=e.item.i,i.rows[i.selidx].selected=!0,i.root.observable.trigger("gridselect",t),e.preventUpdate=!0,i.update()}.bind(this),this._dbclick=function(e){data={id:i.rid,data:e.item},i.ongriddbclick&&i.ongriddbclick(data),i.root.observable.trigger("griddbclick",data)}.bind(this)}),riot.tag2("afx-grid-row",'<div riot-style="{!header? ⁗display: table-cell;⁗ :⁗⁗}" onclick="{parent._cell_select}" each="{child,i in cols}" class="{string:typeof child.value == ⁗string⁗, number: typeof child.value == ⁗number⁗, cellselected: parent._auto_cell_select(child,i)}"> <afx-label color="{child.color}" icon="{child.icon}" iconclass="{child.iconclass}" text="{child.value}"></afx-label> </div>',"","",function(opts){this.cols=opts.cols||[];var self=this;this.rid=opts.rootid,this.index=opts.index,this.header=eval(opts.header)||!1,this.head=opts.head,this.selidx=-1,self.observable=opts.observable,this.colssize=[];var update_header_size=function(){if(self.cols&&0!=self.cols.length){var e=$(self.root).parent().width();if(0!=e){var o=0,i=0;if(self.colssize=[],$.each(self.cols,function(e,t){t.width?(self.colssize.push(t.width),o+=t.width):(self.colssize.push(-1),i++)}),0<i){var s=parseInt((e-o)/i);$.each(self.colssize,function(e,t){-1==t&&(self.colssize[e]=s)})}calibrate_size()}}},calibrate_size=function(){var e=0;$(self.root).children().each(function(){$(this).css("width",self.colssize[e]+"px"),e++})};this.on("updated",function(){self.header?update_header_size():self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())}),this.on("mount",function(){self.header?($(self.root).css("display","flex").css("flex-direction","row"),update_header_size()):($(self.root).css("display","table-row").css("width","100%"),self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())),self.observable.on("gridcellselect",function(e){e.id==self.rid&&-1!=self.selidx&&e.row!=self.index&&(self.cols[self.selidx].selected=!1,self.selidx=-1)}),self.observable.on("resize",function(){self.update()})}),this._cell_select=function(e){self.header||(-1!=self.selidx&&(self.cols[self.selidx].selected=!1,self.selidx=-1),self.cols[e.item.i].selected=!0)}.bind(this),this._auto_cell_select=function(e,t){if(!e.selected||self.header)return!1;if(self.selidx==t)return!0;var o={id:self.rid,data:e,col:t,row:self.index};return self.selidx=t,self.observable.trigger("gridcellselect",o),!0}.bind(this)}),riot.tag2("afx-hbox",'<div ref="container" class="afx-hbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var r=this;this.rid=$(r.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){r.root.observable=r.parent&&r.parent.root&&r.parent.root.observable||e.observable||riot.observable(),$(r.refs.container).css("display","flex").css("flex-direction","row").css("width","100%"),o(),r.root.observable&&(r.root.observable.on("resize",function(e,t){o()}),r.root.observable.on("calibrate",function(){o()}))}),r.root.update=function(){r.update()};var o=function(){var o,e,i=[],s=0;e=$(r.root).height(),avaiWidth=$(r.root).width(),$(r.refs.container).css("height",e+"px"),$(r.refs.container).children().each(function(e){this.observable=r.root.observable;var t=$(this).attr("data-width");if(t){if("grow"==t)return;"%"===t[t.length-1]&&(t=Number(t.slice(0,-1))*avaiWidth/100),$(this).css("width",t+"px"),s+=Number(t)}else $(this).css("flex-grow","1"),i.push(this)}),0<(o=(avaiWidth-s)/i.length)&&$.each(i,function(e,t){$(t).css("width",o+"px")}),r.root.observable.trigger("hboxchange",{id:r.rid,w:o,h:e})}}),riot.tag2("afx-html","","",'ref="container"',function(e){this.content=e.content,this.root.innerHTML=this.content,this.updateContent=void 0;var o=this;this.root.set=function(e,t){o[e]=t,"content"==e?o.root.innerHTML=t:"updateContent"==e&&o.update()},this.on("update",function(){o.updateContent&&(o.root.innerHTML=o.updateContent())})}),riot.tag2("afx-label",'<span riot-style="{color?⁗color:⁗ + color:⁗⁗}"> <i if="{iconclass}" class="{iconclass}"></i> <i if="{icon}" class="icon-style" riot-style="{⁗background: url(⁗+window.OS.API.handler.get+⁗/⁗+icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> {text?text.__():⁗⁗} </span>',"","",function(i){this.iconclass=i.iconclass,this.icon=i.icon,this.text=i.text,this.color=i.color;var s=this;this.on("update",function(){s.iconclass=i.iconclass,s.icon=i.icon,s.text=i.text,s.color=i.color}),s.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;s.update()},s.root.get=function(e){return s[e]}}),riot.tag2("afx-list-view",'<div class="list-container" ref="container" style="flex:1;"> <div if="{opts.dropdown == ⁗true⁗}" ref="current" onclick="{show_list}"> <afx-label ref="drlabel"></afx-label> </div> <ul ref="mlist"> <li each="{item,i in items}" class="{selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}"> <afx-label class="{item.class}" color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> <i if="{item.closable}" class="closable" click="{parent._remove}"></i> <ul if="{item.complex}" class="complex-content"> <li each="{ctn,j in item.detail}" class="{ctn.class}">{ctn.text.toString()}</li> </ul> </li> </ul> </div> <div if="{opts.dropdown != ⁗true⁗ && buttons}" class="button_container"> <afx-button each="{btn,i in buttons}" text="{btn.text}" icon="{btn.icon}" iconclass="{btn.iconclass}" onbtclick="{btn.onbtclick}"></afx-button> </div>',"",'class="{dropdown: opts.dropdown == ⁗true⁗}" style="display:flex; flex-direction:column"',function(i){this.items=i.items||[];var s=this;s.selidx=-1,s.onlistselect=i.onlistselect,s.onlistdbclick=i.onlistdbclick,s.onitemclose=i.onitemclose,s.buttons=i.buttons;var n=!1;this.rid=$(s.root).attr("data-id")||Math.floor(1e5*Math.random())+1,s.root.set=function(e,t){if("selected"==e)-1!=s.selidx&&(s.items[s.selidx].selected=!1),-1==t?s.selidx=-1:s.items[t]&&(s.items[t].selected=!0);else if("*"==e)for(var o in t)s[o]=t[o];else s[e]=t;s.update()},s.root.get=function(e){return"selected"==e?-1!=s.selidx?s.items[s.selidx]:void 0:"count"==e?s.items.length:s[e]},s.root.selectNext=function(){var e=s.selidx+1;e>=s.items.length||(-1!=s.selidx&&(s.items[s.selidx].selected=!1),s.items[e].selected=!0,s.update())},s.root.selectPrev=function(){var e=s.selidx-1;e<0||(-1!=s.selidx&&(s.items[s.selidx].selected=!1),s.items[e].selected=!0,s.update())},s.root.push=function(e,t){s.items.push(e),t&&s.update()},s.root.unshift=function(e,t){s.items.unshift(e),t&&s.update()},s.root.replaceItem=function(e,t,o){var i=s.items.indexOf(e);0<=i&&(s.items[i]=t,o&&s.update())},s.root.remove=function(e,t){var o=s.items.indexOf(e);0<=o&&(-1!=s.selidx&&(s.items[s.selidx].selected=!1,s.selidx=-1),s.items.splice(o,1),t&&s.update(),n=!0)},i.observable?this.root.observable=i.observable:this.root.observable=riot.observable(),this.on("mount",function(){if(s.root.observable=i.observable||s.parent&&s.parent.root&&s.parent.root.observable||riot.observable(),"true"==i.dropdown){var e=function(){$(s.refs.container).css("width",$(s.root).width()+"px"),$(s.refs.current).css("width",$(s.root).width()+"px"),$(s.refs.mlist).css("width",$(s.root).width()+"px")};e(),s.root.observable.on("calibrate",function(){e()}),s.root.observable.on("resize",function(){e()}),$(document).click(function(e){$(e.target).closest(s.refs.container).length||$(s.refs.mlist).hide()}),$(s.refs.container).css("position","absolute").css("display","inline-block"),$(s.refs.mlist).css("position","absolute").css("display","none").css("top","100%").css("left","0"),s.root.observable.on("vboxchange",function(e){e.id==s.parent.rid&&$(s.refs.container).css("width",$(s.root).parent().innerWidth()+"px")})}}),this.show_list=function(e){$("#desktop").height()<$(s.root).offset().top+$(s.refs.mlist).height()?$(s.refs.mlist).css("top","-"+$(s.refs.mlist).outerHeight()+"px"):$(s.refs.mlist).css("top","100%"),$(s.refs.mlist).show(),e.preventUpdate=!0}.bind(this),this._remove=function(e){r=!0,s.onitemclose&&(r=s.onitemclose(e)),r&&s.root.remove(e.item.item,!0)}.bind(this),this._autoselect=function(e,t){if(!e.selected||0==e.selected)return!1;if(s.selidx==t)return!0;var o={id:s.rid,data:e,idx:t};return s.selidx=t,"true"==i.dropdown&&($(s.refs.mlist).hide(),s.refs.drlabel.root.set("*",e)),s.onlistselect&&s.onlistselect(o),this.root.observable.trigger("listselect",o),!0}.bind(this),this._select=function(e){if(n)return n=!1,void(e.preventUpdate=!0);-1!=s.selidx&&s.selidx<s.items.length&&(s.items[s.selidx].selected=!1),e.item.item.selected=!0}.bind(this),this._dbclick=function(e){data={id:s.rid,data:e.item.item,idx:e.item.i},s.onlistdbclick&&s.onlistdbclick(data),s.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-menu",'<ul class="{context: opts.context == ⁗true⁗}"> <li class="afx-corner-fix"></li> <li ref="container" each="{data,i in items}" class="{afx_submenu:data.child != null && data.child.length > 0, fix_padding:data.icon}" no-reorder> <a href="#" onclick="{parent.onselect}"> <afx-switch if="{data.switch || data.radio}" class="{checked:parent.checkItem(data)}" enable="false" swon="{data.checked}"></afx-switch> <afx-label color="{data.color}" iconclass="{data.iconclass}" icon="{data.icon}" text="{data.text}"></afx-label> <span if="{data.shortcut}" class="shortcut">{data.shortcut}</span> </a> <afx-menu ref="submenus" index="{i}" if="{data.child != null && data.child.length > 0}" child="{data.child}" onmenuselect="{data.onmenuselect}" observable="{parent.root.observable}" rootid="{parent.rid}"></afx-menu> </li> <li class="afx-corner-fix"></li> </ul>',"","",function(i){var o;this.items=i.child||[],null!=i.index?this.index=i.index:this.index=-1;var s=void 0;i.rootid?(this.rid=i.rootid,o=!1):(this.rid=$(this.root).attr("data-id")||Math.floor(1e5*Math.random())+1,o=!0);var r=this;this.onmenuselect=i.onmenuselect,this.checkItem=function(e){return 1==e.checked&&e.radio&&(s&&(s.checked=!1),(s=e).checked=!0),!1}.bind(this),r.root.set=function(e,t){if("*"==e)for(var o in t)r[o]=t[o];else r[e]=t;r.update()},r.root.push=function(e,t){r.items.push(e),t&&r.update()},r.root.unshift=function(e,t){r.items.unshift(e),t&&r.update()},r.root.remove=function(e,t){var o=r.items.indexOf(e);0<=o&&r.items.splice(o,1),t&&r.update()},r.root.update=function(){r.update()},r.root.get=function(e){return r[e]},r.root.show=function(e){"true"==i.context&&($(r.root).css("top",e.clientY-15+"px").css("left",e.clientX-5+"px").show(),$(document).on("click",n))},i.observable?this.root.observable=i.observable:(this.root.observable=riot.observable(),this.root.observable.on("menuselect",function(e){if(r.onmenuselect&&r.onmenuselect(e),"true"==i.context)$(r.root).hide();else if(!e.root&&r.refs.container){var t=r.refs.container.length?r.refs.container:[r.refs.container];for(var o in t)$("afx-menu",t[o]).first().hide()}}));var n=function(e){if("true"!=i.context){if(!$(e.target).closest(r.refs.container).length&&r.refs.container){var t=r.refs.container.length?r.refs.container:[r.refs.container];for(var o in t)$("afx-menu",t[o]).first().hide();$(document).unbind("click",n)}else if(r.refs.container&&r.refs.container.length)for(var o in r.refs.container)$(e.target).closest(r.refs.container[o]).length||$("afx-menu",r.refs.container[o]).first().hide()}else $(e.target).closest(r.root).length||($(r.root).hide(),$(document).unbind("click",n))};this.onselect=function(e){var t={id:r.rid,root:o,e:e,item:e.item};if(e.item.data.switch?e.item.data.checked=!e.item.data.checked:e.item.data.radio&&(s&&(s.checked=!1),e.item.data.checked=!0,s=e.item.data),this.root.observable.trigger("menuselect",t),this.onmenuselect&&!o&&this.onmenuselect(t),e.preventDefault(),$(document).unbind("click",n),"true"!=i.context)return o&&r.refs.container?(r.refs.container.length?$("afx-menu",r.refs.container[e.item.i]).first().show():$("afx-menu",r.refs.container).first().show(),void $(document).on("click",n)):void 0}.bind(this)}),riot.tag2("afx-overlay","<yield></yield>","","",function(e){this.width=e.width||200,this.height=e.height||400;var i=this;i.commander=null,this.root.observable=e.observable||riot.observable();var t=$(i.root).attr("data-id"),s=function(){$(i.root).css("width",i.width+"px").css("height",i.height+"px"),i.root.observable.trigger("resize",{id:t,w:i.width,h:i.height})};i.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;"width"!=e&&"height"!=e||s(),i.update()},i.root.get=function(e){return i[e]},i.on("mount",function(){$(i.root).css("position","absolute"),$(i.root).children().each(function(e){this.observalbe=i.root.observalbe}),s(),i.root.observable.trigger("rendered",i.root)})}),riot.tag2("afx-resizer","","","",function(e){var o=this;o.dir="hz",o.resizable=void 0,o.parent=void 0,o.minsize=0,o.on("mount",function(){var e=$(o.parent.root).prop("tagName");o.resizable=1==$(o.root).prev().length?$(o.root).prev()[0]:void 0,"AFX-HBOX"==e?(o.dir="hz",$(o.root).css("cursor","col-resize"),o.resizable&&(o.minsize=parseInt($(o.resizable).attr("min-width")))):"AFX-VBOX"==e?(o.dir="ve",$(o.root).css("cursor","row-resize"),o.resizable&&(o.minsize=parseInt($(o.resizable).attr("min-height")))):o.dir="none",o.minsize||(o.minsize=10),t()});var t=function(){$(o.root).css("user-select","none"),$(o.root).on("mousedown",function(e){e.preventDefault(),$(window).on("mousemove",function(e){o.resizable&&("hz"==o.dir?i(e):"ve"==o.dir&&s(e))}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},i=function(e){if(o.resizable){var t=$(o.resizable).offset();w=Math.round(e.clientX-t.left),w<o.minsize&&(w=o.minsize),$(o.resizable).attr("data-width",w.toString()),o.parent.root.observable.trigger("calibrate",o.resizable)}},s=function(e){if(o.resizable){var t=$(o.resizable).offset();h=Math.round(e.clientY-t.top),h<o.minsize&&(h=minsize),$(o.resizable).attr("data-height",h.toString()),o.parent.root.observable.trigger("calibrate",o.resizable)}}}),riot.tag2("afx-slider",'<div class="container" ref="container"> <div class="progress" ref="prg"></div> <div if="{dragable}" class="dragpoint" ref="point"></div> </div>',"","",function(opts){this.value=Number(opts.value)||0,this.max=Number(opts.max)||100,null!=opts.dragable?this.dragable=eval(opts.dragable):this.dragable=!0,this.onchanging=opts.onchanging,this.onchange=opts.onchange;var self=this;self.root.set=function(e,t){if("*"==e)for(var o in t)self[o]=t[o];else self[e]=t;self.update()},self.root.get=function(e){return self[e]};var calibrate=function(){self.value>self.max&&(self.value=self.max),$(self.refs.container).css("width",$(self.root).width()+"px");var e=$(self.refs.container).width()*self.value/self.max;if($(self.refs.prg).css("width",e+"px").css("height",$(self.refs.container).height()+"px"),self.dragable){var t=e-$(self.refs.point).width()/2,o=Math.floor(($(self.refs.prg).height()-$(self.refs.point).height())/2);$(self.refs.point).css("left",t+"px").css("top",o+"px")}};self.on("update",function(){calibrate()});var enable_dragging=function(){$(self.refs.point).css("user-select","none").css("cursor","default"),$(self.refs.point).on("mousedown",function(e){e.preventDefault(),offset=$(self.refs.container).offset(),$(window).on("mousemove",function(e){var t;t=(t=e.clientX-offset.left)<0?0:t;var o=$(self.refs.container).width();t=o<t?o:t,self.value=t*self.max/o,calibrate(),self.onchanging&&self.onchanging(self.value)}),$(window).on("mouseup",function(e){self.onchange&&self.onchange(self.value),$(window).unbind("mousemove",null)})})};self.on("mount",function(){self.root.observable=opts.observable||self.parent&&self.parent.root&&self.parent.root.observable||riot.observable(),self.dragable&&($(self.refs.point).css("position","absolute"),$(self.refs.point).hide(),$(self.root).mouseover(function(){$(self.refs.point).show()}).mouseout(function(){$(self.refs.point).hide()}),enable_dragging()),$(self.refs.container).click(function(e){var t=$(self.refs.container).offset(),o=e.clientX-t.left,i=$(self.refs.container).width();self.value=o*self.max/i,calibrate(),self.onchange&&self.onchange(self.value),self.onchanging&&self.onchanging(self.value)}),self.root.observable.on("calibrate",function(){calibrate()}),self.root.observable.on("resize",function(){calibrate()}),calibrate()})}),riot.tag2("afx-switch",'<span class="{swon: swon}" onclick="{toggle}"></span>',"","",function(i){null!=i.swon?this.swon=i.swon:this.swon=!1;var s=this;null!=i.enable?this.enable=i.enable:this.enable=!0,this.onchange=i.onchange,this.rid=$(s.root).attr("data-id")||Math.floor(1e5*Math.random())+1,s.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;s.update()},s.root.get=function(e){return s[e]},this.root.toggle=function(){i.swon=!s.swon,s.update()},this.on("update",function(e){s.swon="function"==typeof i.swon?i.swon():i.swon}),this.toggle=function(e){if(s.enable){i.swon=!s.swon,s.swon=i.swon;var t={id:s.rid,data:i.swon};i.onchange&&i.onchange(t),s.root.observable&&s.root.observable.trigger("switch",t)}}.bind(this)}),riot.tag2("afx-sys-panel",'<div> <afx-menu data-id="os_menu" ref="aOsmenu" child="{osmenu.child}" onmenuselect="{osmenu.onmenuselect}" class="afx-panel-os-menu"></afx-menu> <afx-menu data-id="appmenu" ref="aAppmenu" child="{appmenu.child}" class="afx-panel-os-app"></afx-menu> <afx-menu data-id="sys_tray" ref="aTray" child="{systray.child}" onmenuselect="{systray.onmenuselect}" class="afx-panel-os-stray"></afx-menu> </div>',"","",function(e){this.osmenu={child:[]},this.appmenu={child:[]},this.systray={child:[],onmenuselect:function(e){e.root&&e.e.item.data.awake(e.e)}};var i=this;i.root.attachservice=function(e){i.refs.aTray.root.unshift(e,!0),e.attach(i.refs.aTray)},i.root.detachservice=function(e){i.refs.aTray.root.remove(e,!0)},i.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;i.update()},i.root.get=function(e){return i[e]},i.root.update=function(){i.update()},this.on("mount",function(){$(i.refs.aOsmenu.root).css("z-index",1e6),$(i.refs.aAppmenu.root).css("z-index",1e6),$(i.refs.aTray.root).css("z-index",1e6),window.OS.courrier.trigger("syspanelloaded")})}),riot.tag2("afx-tab-bar",'<afx-list-view ref="list"></afx-list-view>',"","",function(e){var i=this;this.closable=e.closable||!1,i.ontabselect=e.ontabselect,i.root.get=function(e){return i.refs.list.root.get(e)},i.root.update=function(){i.update(!0)},i.on("mount",function(){i.root.observable=e.observable||i.parent&&i.parent.root&&i.parent.root.observable||riot.observable(),i.refs.list.root.observable=i.root.observable,i.refs.list.root.set("onlistselect",function(e){i.root.observable.trigger("tabselect",e),i.ontabselect&&i.ontabselect(e)})}),i.root.set=function(e,t){if("*"==e)for(var o in t)i.refs.list.root.set(o,t[o]);else if("closable"==e)i.closable=t;else if("ontabselect"==e)i.ontabselect=t;else{if("items"==e)for(var o in t)t[o].closable=i.closable;i.refs.list.root.set(e,t)}},i.root.push=function(e,t){e.closable=i.closable,i.refs.list.root.push(e,t)},i.root.replaceItem=function(e,t,o){t.closable=i.closable,i.refs.list.root.replaceItem(e,t,o)},i.root.unshift=function(e,t){i.refs.list.root.unshift(e,t)},i.root.remove=function(e,t){i.refs.list.root.remove(e,t)}}),riot.tag2("afx-tab-container",'<afx-hbox ref="mybox" if="{bar == ⁗left⁗}"> <afx-tab-bar data-ref="tabbar"></afx-tab-bar> <div data-ref="container"></div> </afx-hbox> <afx-vbox ref="mybox" if="{bar == ⁗top⁗}"> <afx-tab-bar data-ref="tabbar"></afx-tab-bar> <div data-ref="container"></div> </afx-vbox>',"","",function(e){this.bar=e.bar||"top",this.barwidth=e.barwidth,this.barheight=e.barheight;var o=this,t=function(){$(o.refs.mybox.root).css("width",$(o.root).width()+"px"),$(o.refs.mybox.root).css("height",$(o.root).height()+"px"),o.root.observable.trigger("calibrate")};o.on("mount",function(){o.tabbar=$("[data-ref='tabbar']",o.root)[0],o.container=$("[data-ref='container']",o.root)[0],o.barwidth&&$(o.tabbar).attr("data-width",o.barwidth),o.barheight&&$(o.tabbar).attr("data-height",o.barheight),o.root.observable=o.parent&&o.parent.root&&o.parent.root.observable||e.observable||riot.observable(),o.tabbar.set("ontabselect",function(e){$(o.container).children().each(function(e){$(this).hide()}),$(e.data.scheme).show(),e.data.handler.render(),t()}),o.root.observable.on("resize",function(){t()})}),o.on("update",function(){$(o.container).children().each(function(e){this.update&&this.update()})});var i=function(e){var t=$.parseHTML(e.scheme);$(o.container).append(t),e.scheme=t,riot.mount(t,{observable:o.root.observable}),$(t).hide(),e.handler=e.handler(t[0]),o.root.observable.trigger("tabrendered")};o.root.setTabs=function(e){var t;e.length<=0?o.tabbar.set("selected",0):(o.root.observable.one("tabrendered",function(){e.splice(0,1),o.root.setTabs(e)}),(t=e[0]).f||(t.f=function(){}),o.tabbar.push(t),t.url?t.url.asFileHandler().read(function(e){t.scheme=e,i(t)}):i(t))}}),riot.tag2("afx-tree-view",'<div class="{afx_tree_item_selected:treeroot.selectedItem && treeroot.selectedItem.treepath == data.treepath, afx_folder_item: isFolder(), afx_tree_item_odd: index%2 != 0}" onclick="{select}" ondblclick="{_dbclick}" oncontextmenu="{select}"> <ul style="padding:0;margin:0;white-space: nowrap;"> <li ref="padding"></li> <li class="itemname" style="display:inline-block;"> <i if="{!isFolder() && data.iconclass}" class="{data.iconclass}"></i> <i if="{!isFolder() && data.icon}" class="icon-style" riot-style="{⁗background: url(⁗+data.icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> <span onclick="{toggle}" if="{isFolder()}" class="{open ? \'afx-tree-view-folder-open\' : \'afx-tree-view-folder-close\'}"></span> {data.name} </li> </ul> </div> <ul if="{isFolder()}" show="{isFolder() && open}"> <li each="{child, i in data.nodes}"> <afx-tree-view ontreeselect="{parent.ontreeselect}" index="{i}" fetch="{parent.fetch}" ontreedbclick="{parent.ontreedbclick}" data="{child}" indent="{indent+1}" observable="{parent.root.observable}" path="{parent.data.treepath + ⁗>⁗ + i}" treeroot="{parent.treeroot}"></afx-tree-view> </li> </ul>',"","",function(e){var i=this;i.open=!0,i.data={name:"",nodes:null,treepath:e.path,i:-1},e.data&&(i.data=e.data,i.open=null==e.data.open||e.data.open),i.rid=$(i.root).attr("data-id")||Math.floor(1e5*Math.random())+1,i.data.rid=i.rid,i.data.i=e.index,i.ontreeselect=e.ontreeselect,i.ontreedbclick=e.ontreedbclick,i.fetch=e.fetch,i.indent=e.indent||0;var t=!1;e.treeroot?(this.treeroot=e.treeroot,this.treeroot.counter++):(this.treeroot=i,this.treeroot.counter=0),i.data.treepath=e.path||0,i.selectedItem=null,i.index=this.treeroot.counter;var r=function(e,t,o,i){if(t[o]==i)return e.push(t);if(t.nodes&&0<t.nodes.length)for(var s in t.nodes)r(e,t.nodes[s],o,i)};i.root.find=function(e,t){var o=[];return r(o,i.data,e,t),o},i.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else if("data"==e)for(var o in t)i.data[o]=t[o];else"selectedItem"==e?(i.ontreeselect&&i.ontreeselect(i.data),i.treeroot.selectedItem=t,i.root.observable.trigger("treeselect",i.data)):i[e]=t;i.update()},i.root.get=function(e){return i[e]},e.observable?this.root.observable=e.observable:this.root.observable=riot.observable(),this.on("mount",function(){$(i.refs.padding).css("display","inline-block").css("height","1px").css("padding",0).css("margin",0).css("background-color","transparent").css("width",15*i.indent+"px")}),this.isFolder=function(){return i.data.nodes}.bind(this),this.toggle=function(e){i.open=!i.open,e.preventDefault(),t=!0,i.open&&0==i.data.nodes.length&&i.fetch&&i.fetch(e.item,function(e){i.data.nodes=e,i.update()})}.bind(this),this.select=function(e){t?t=!1:(i.ontreeselect&&i.ontreeselect(i.data),i.treeroot.selectedItem=i.data,this.root.observable.trigger("treeselect",i.data),e.preventUpdate=!0,i.treeroot.update(),e.preventDefault())}.bind(this),this._dbclick=function(e){t?t=!1:(i.ontreedbclick&&i.ontreedbclick(i.data),i.root.observable.trigger("treedbclick",i.data))}.bind(this)}),riot.tag2("afx-vbox",'<div ref="container" class="afx-vbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var n=this;this.rid=$(n.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){n.root.observable=n.parent&&n.parent.root&&n.parent.root.observable||e.observable||riot.observable(),$(n.refs.container).css("display","flex").css("flex-direction","column").css("width","100%"),o(),n.root.observable&&(n.root.observable.on("resize",function(e,t){o()}),n.root.observable.on("calibrate",function(){o()}))}),n.root.update=function(){n.update()};var o=function(){var o,i,s=[],r=0;i=$(n.root).height(),avaiwidth=$(n.root).width(),$(n.refs.container).css("height",i+"px"),$(n.refs.container).children().each(function(e){this.observable=n.root.observable;var t=$(this).attr("data-height");if(t){if("grow"==t)return;"%"===t[t.length-1]&&(t=Number(t.slice(0,-1))*i/100),$(this).css("height",t+"px"),r+=Number(t)}else $(this).css("flex-grow","1"),s.push(this)}),0<(o=(i-r)/s.length)&&$.each(s,function(e,t){$(t).css("height",o+"px")}),n.root.observable.trigger("vboxchange",{id:n.rid,w:avaiwidth,h:o})}});