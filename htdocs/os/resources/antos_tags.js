riot.tag2("afx-app-window",'<div class="afx-window-wrapper"> <ul class="afx-window-top"> <li class="afx-window-close" onclick="{close}"></li> <li if="{minimizable == true}" class="afx-window-minimize" onclick="{minimize}"></li> <li if="{resizable == true}" class="afx-window-maximize" onclick="{maximize}"></li> <li ref="dragger" class="afx-window-title">{apptitle}</li> </ul> <div class="afx-clear"></div> <div ref="content" class="afx-window-content"> <yield></yield> </div> <div if="{resizable == true}" ref="grip" class="afx-window-grip"> </div>',"",'ref="window"',function(opts){this.apptitle=opts.apptitle||"",null==opts.minimizable?this.minimizable=!0:this.minimizable=eval(opts.minimizable),null==opts.resizable?this.resizable=!0:this.resizable=eval(opts.resizable);var self=this,offset={top:0,left:0},desktop_pos=$("#desktop").offset(),isMaxi=!1,history={},width=opts.width||400,height=opts.height||300;this.root.observable=opts.observable||riot.observable(),window._zindex||(window._zindex=10),this.shown=!1,self.root.contextmenuHandler=function(e){},self.root.set=function(e,t){if("*"==e)for(var i in t)self[i]=t[i];else self[e]=t;self.update()},self.root.get=function(e){return self[e]},this.minimize=function(){this.root.observable.trigger("hide")}.bind(this),this.close=function(){this.root.observable.trigger("exit")}.bind(this),this.on("mount",function(){var e,t;e=($("#desktop").width()-width)/2,t=($("#desktop").height()-height)/2,$(self.refs.window).css("position","absolute").css("left",e+"px").css("top",t+"px").css("width",width+"px").css("height",height+"px").css("z-index",window._zindex++),$(self.refs.window).on("mousedown",function(e){0==self.shown&&self.root.observable.trigger("focus")}),$(self.refs.window).click(function(e){}),enable_dragging(),self.resizable&&enable_resize(),$(self.refs.dragger).dblclick(function(e){toggle_window()}),$(self.refs.content).children().each(function(e){this.observable=self.root.observable});var i=function(){var e=$(self.refs.content).height()/$(self.refs.content).children().length;$(self.refs.content).children().each(function(t){$(this).css("height",e+"px")})};i(),self.root.observable.on("resize",function(){i()}),self.root.observable.on("focus",function(){window._zindex++,$(self.refs.window).show().css("z-index",window._zindex).removeClass("unactive"),self.shown=!0}),self.root.observable.on("blur",function(){self.shown=!1,$(self.refs.window).addClass("unactive")}),self.root.observable.on("hide",function(){$(self.refs.window).hide(),self.shown=!1}),self.root.observable.on("toggle",function(){self.shown?self.root.observable.trigger("hide"):self.root.observable.trigger("focus")}),self.root.observable.trigger("rendered",self.root)});var enable_dragging=function(){$(self.refs.dragger).css("user-select","none").css("cursor","default"),$(self.refs.dragger).on("mousedown",function(e){e.preventDefault(),(offset=$(self.refs.window).offset()).top=e.clientY-offset.top,offset.left=e.clientX-offset.left,$(window).on("mousemove",function(e){var t,i;isMaxi?(toggle_window(),t=0,letf=e.clientX-$(self.refs.window).width()/2,offset.top=10,offset.left=$(self.refs.window).width()/2):(t=e.clientY-offset.top-desktop_pos.top,i=(i=e.clientX-desktop_pos.top-offset.left)<0?0:i,t=t<0?0:t),$(self.refs.window).css("top",t+"px").css("left",i+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},enable_resize=function(){self.resizable&&($(self.refs.grip).css("user-select","none").css("cursor","default").css("position","absolute").css("bottom","0").css("right","0").css("cursor","nwse-resize"),$(self.refs.grip).on("mousedown",function(e){e.preventDefault(),offset.top=e.clientY,offset.left=e.clientX,$(window).on("mousemove",function(e){var t,i;t=(t=$(self.refs.window).width()+e.clientX-offset.left)<100?100:t,i=(i=$(self.refs.window).height()+e.clientY-offset.top)<100?100:i,offset.top=e.clientY,offset.left=e.clientX,$(self.refs.window).css("width",t+"px").css("height",i+"px"),isMaxi=!1,self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:t,h:i})}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})}))},toggle_window=function(){var e,t;self.resizable&&(0==isMaxi?(history={top:$(self.refs.window).css("top"),left:$(self.refs.window).css("left"),width:$(self.refs.window).css("width"),height:$(self.refs.window).css("height")},e=$("#desktop").width()-5,t=$("#desktop").height()-10,$(self.refs.window).css("width",e+"px").css("height",t+"px").css("top","0").css("left","0"),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:e,h:t}),isMaxi=!0):(isMaxi=!1,$(self.refs.window).css("width",history.width).css("height",history.height).css("top",history.top).css("left",history.left),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:history.width,h:history.height})))};this.maximize=function(){toggle_window()}.bind(this)}),riot.tag2("afx-apps-dock",'<afx-button class="{selected: parent.selectedApp && app.pid == parent.selectedApp.pid}" each="{items}" icon="{icon}" text="{text}" onbtclick="{onbtclick}"> </afx-button>',"","",function(e){this.items=e.items||[];var t=this;t.selectedApp=null,t.root.set=function(e,i){if("*"==e)for(var o in i)t[o]=i[o];else if(t[e]=i,"selectedApp"==e){for(var o in t.items)t.items[o].app.blur();i&&$("#desktop")[0].set("selected",-1)}t.update()},t.root.newapp=function(e){for(var e in t.items.push(e),t.selectedApp=e.app,t.update(),t.items)t.items[e].app.blur()},t.root.removeapp=function(e){var i=-1;for(var o in t.items)if(t.items[o].app.pid==e.pid){i=o;break}-1!=i&&(delete t.items[i].app,t.items.splice(i,1),t.update())},t.root.get=function(e){return t[e]},this.on("mount",function(){window.OS.courrier.trigger("sysdockloaded")})}),riot.tag2("afx-button",'<button disabled="{enable == ⁗false⁗}" onclick="{_onbtclick}" ref="mybtn"> <afx-label color="{color}" icon="{icon}" iconclass="{iconclass}" text="{text}"></afx-label> </button>',"","",function(opts){this.enable=opts.enable,this.icon=opts.icon,this.iconclass=opts.iconclass,this.color=opts.color,this.text=opts.text||"";var self=this;this.onbtclick=opts.onbtclick,self.root.set=function(e,t){if("*"==e)for(var i in t)self[i]=t[i];else self[e]=t;self.update()},self.root.trigger=function(){$(self.refs.mybtn).trigger("click")},self.root.get=function(e){return self[e]},this._onbtclick=function(e){"string"==typeof self.onbtclick?eval(self.onbtclick):self.onbtclick&&self.onbtclick(e),self.root.observable&&self.root.observable.trigger("btclick",{id:$(self.root).attr("data-id"),data:self.root})}}),riot.tag2("afx-calendar-view",'<div><i class="prevmonth" onclick="{prevmonth}"></i>{text}<i onclick="{nextmonth}" class="nextmonth"></i></div> <afx-grid-view data-id="{⁗grid_⁗ + rid}" style="height:100%;" ref="grid" header="{header}"> </afx-grid-view>',"","",function(e){this.header=[{value:"Sun"},{value:"Mon"},{value:"Tue"},{value:"Wed"},{value:"Thu"},{value:"Fri"},{value:"Sat"}],this.root.observable=e.observable;var t=this;this.day=0,this.month=0,this.year=0,this.ondayselect=e.ondayselect,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.selectedDate=void 0,t.root.get=function(e){return t[e]},this.on("mount",function(e){t.refs.grid.root.observable=t.root.observable,i(null),t.root.observable.on("gridcellselect",function(e){if(e.id=="grid_"+t.rid&&""!=e.data.value){var i={id:t.rid,data:new Date(t.year,t.month,e.data.value)};t.ondayselect&&t.ondayselect(i),t.selectedDate=i.data,t.root.observable.trigger("dayselect",i)}})}),this.prevmonth=function(){t.selectedDate=void 0,this.month--,this.month<0&&(this.month=11,this.year--),i(new Date(this.year,this.month,1))}.bind(this),this.nextmonth=function(){t.selectedDate=void 0,this.month++,this.month>11&&(this.month=0,this.year++),i(new Date(this.year,this.month,1))}.bind(this);var i=function(e){null===e&&(e=new Date),t.day=e.getDate(),t.month=e.getMonth(),t.year=e.getFullYear();var i=(new Date).getDate(),o=(new Date).getMonth(),s=(new Date).getFullYear();months=["January","February","March","April","May","June","July","August","September","October","November","December"],this_month=new Date(t.year,t.month,1),next_month=new Date(t.year,t.month+1,1),first_week_day=this_month.getDay(),days_in_this_month=Math.round((next_month.getTime()-this_month.getTime())/864e5),t.text=months[t.month]+" "+t.year;var r=[],n=[];for(week_day=0;week_day<first_week_day;week_day++)n.push({value:""});for(week_day=first_week_day,day_counter=1;day_counter<=days_in_this_month;day_counter++)week_day%=7,0==week_day&&(r.push(n),n=[]),i==day_counter&&t.month==o&&t.year==s?n.push({value:day_counter,selected:!0}):n.push({value:day_counter}),week_day++;for(var a=0;a<=7-n.length;a++)n.push({value:""});r.push(n),t.refs.grid.root.set("rows",r)}}),riot.tag2("afx-color-picker",'<div style="width:310px; height:190px;display:block; padding:3px;"> <canvas class="color-palette" width="284" height="155" style="float:left;" ref="palette"></canvas> <div class="color-sample" style="width:15px; height:155px; text-align:center; margin-left:3px; display:block;float:left;" ref="colorval"></div> <div class="afx-clear"></div> <div style="margin-top:3px;"> <span>Hex:</span><input type="text" ref="hextext" style="width:70px; margin-left:3px;margin-right:5px;"></input> <span ref="rgbtext"></span> </div> </div>',"","",function(e){var t=this,i=void 0;t.root.observable=e.observable,t.oncolorsetect=e.oncolorsetect,t.selectedColor=void 0,t.root.set=function(e,i){if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;t.update()},t.root.get=function(e){return t[e]};this.on("mount",function(){!function(){var e=(i=$(t.refs.palette).get(0).getContext("2d")).createLinearGradient(0,0,$(t.refs.palette).width(),0);e.addColorStop(0,"rgb(255,   0,   0)"),e.addColorStop(.15,"rgb(255,   0, 255)"),e.addColorStop(.33,"rgb(0,     0, 255)"),e.addColorStop(.49,"rgb(0,   255, 255)"),e.addColorStop(.67,"rgb(0,   255,   0)"),e.addColorStop(.84,"rgb(255, 255,   0)"),e.addColorStop(1,"rgb(255,   0,   0)"),e.addColorStop(0,"rgb(0,   0,   0)"),i.fillStyle=e,i.fillRect(0,0,i.canvas.width,i.canvas.height),(e=i.createLinearGradient(0,0,0,$(t.refs.palette).width())).addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0,     0,   0, 0)"),e.addColorStop(1,"rgba(0,     0,   0, 1)"),i.fillStyle=e,i.fillRect(0,0,i.canvas.width,i.canvas.height);var o=function(e){return s=e.toString(16),1==s.length&&(s="0"+s),s},r=function(e){$(t.refs.palette).css("cursor","crosshair");var s=$(t.refs.palette).offset(),r=e.pageX-s.left,n=e.pageY-s.top,a=i.getImageData(r,n,1,1);return{r:a.data[0],g:a.data[1],b:a.data[2],text:"rgb("+a.data[0]+", "+a.data[1]+", "+a.data[2]+")",hex:"#"+o(a.data[0])+o(a.data[1])+o(a.data[2])}},n=function(e){var i=r(e);$(t.refs.colorval).css("background-color",i.text)};$(t.refs.palette).mouseenter(function(e){$(t.refs.palette).on("mousemove",n)}),$(t.refs.palette).mouseout(function(e){$(t.refs.palette).unbind("mousemove",n),t.selectedColor&&$(t.refs.colorval).css("background-color",t.selectedColor.text)}),$(t.refs.palette).on("click",function(e){data=r(e),$(t.refs.rgbtext).html(data.text),$(t.refs.hextext).val(data.hex),t.selectedColor=data,t.oncolorsetect&&t.oncolorsetect(data),t.root.observable&&t.root.observable.trigger("colorselect",data)})}()})}),riot.tag2("afx-dummy","<yield></yield>","","",function(e){}),riot.tag2("afx-file-view",'<afx-list-view ref="listview" observable="{root.observable}"></afx-list-view> <afx-grid-view ref="gridview" header="{header}" observable="{root.observable}"></afx-grid-view> <div class="treecontainer" ref="treecontainer"> <afx-tree-view ref="treeview" observable="{root.observable}"></afx-tree-view> </div> <div if="{status == true}" class="status" ref="stbar"></div>',"","",function(e){var t=this;t.root.observable=e.observable||riot.observable(),t.view=e.view||"list",t.data=e.data||[],t.path=e.path||"home:///",t.onfileselect,t.onfileopen,this.status=null==e.status||e.status,this.selectedFile=void 0,this.showhidden=e.showhidden,this.preventUpdate=!1,this.fetch=e.fetch,this.chdir=e.chdir,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.header=[{value:"File name"},{value:"Type",width:150},{value:"Size",width:70}],t.root.set=function(e,i){if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;"view"==e&&n(),"data"==e&&(t.selectedFile=void 0),"preventUpdate"!=e&&t.update()},t.root.get=function(e){return t[e]};var i=function(e,t){return e.type<t.type?-1:e.type>t.type?1:0},o=function(){var e=$(t.root).outerHeight(),i=$(t.root).width();t.refs.stbar&&(e-=$(t.refs.stbar).height()+10),$(t.refs.listview.root).css("height",e+"px"),$(t.refs.gridview.root).css("height",e+"px"),$(t.refs.treecontainer).css("height",e+"px"),$(t.refs.listview.root).css("width",i+"px"),$(t.refs.gridview.root).css("width",i+"px"),$(t.refs.treecontainer).css("width",i+"px")},s=function(e){return nodes=[],$.each(e,function(e,i){("."!=i.filename[0]||t.showhidden)&&(i.name=i.filename,"dir"==i.type&&(i.nodes=[],i.open=!1),i.iconclass=i.iconclass?i.iconclass:i.type,i.icon=i.icon,nodes.push(i))}),nodes},r=function(){var e,o;t.data.sort(i),"icon"==t.view?(o=[],$.each(t.data,function(e,i){("."!=i.filename[0]||t.showhidden)&&(i.text=i.filename,i.text.length>10&&(i.text=i.text.substring(0,9)+"..."),i.iconclass=i.iconclass?i.iconclass:i.type,i.icon=i.icon,o.push(i))}),t.refs.listview.root.set("items",o)):"list"==t.view?(e=[],$.each(t.data,function(i,o){if("."!=o.filename[0]||t.showhidden){var s=[{value:o.filename,iconclass:o.iconclass?o.iconclass:o.type,icon:o.icon},{value:o.mime},{value:o.size},{idx:i}];e.push(s)}}),t.refs.gridview.root.set("rows",e)):function(){t.refs.treeview.root.set("selectedItem",null);var e={};e.name=t.path,e.nodes=s(t.data),t.refs.treeview.root.set("data",e)}()},n=function(){switch($(t.refs.listview.root).hide(),$(t.refs.gridview.root).hide(),$(t.refs.treecontainer).hide(),t.selectedFile=void 0,t.refs.listview.root.set("selected",-1),t.refs.treeview.selectedItem=void 0,t.refs.treeview.root.set("fetch",function(e,i){t.fetch&&t.fetch(e,function(e){i(s(e))})}),$(t.refs.stbar).html(""),t.view){case"icon":$(t.refs.listview.root).show();break;case"list":$(t.refs.gridview.root).show();break;case"tree":$(t.refs.treecontainer).show()}o()};t.on("updated",function(){t.preventUpdate?t.preventUpdate=!1:r()}),t.on("mount",function(){n(),t.refs.listview.onlistselect=function(e){e.id=t.rid,t.root.observable.trigger("fileselect",e)},t.refs.listview.onlistdbclick=function(e){e.id=t.rid,t.root.observable.trigger("filedbclick",e)},t.refs.gridview.root.observable=t.root.observable,t.refs.gridview.ongridselect=function(e){var i={id:t.rid,data:t.data[e.data.child[3].idx],idx:e.data.child[3].idx};t.root.observable.trigger("fileselect",i)},t.refs.gridview.ongriddbclick=function(e){var i={id:t.rid,data:t.data[e.data.child[3].idx],idx:e.data.child[3].idx};t.root.observable.trigger("filedbclick",i)},t.refs.treeview.ontreeselect=function(e){if(e){var i=e;0==e.treepath&&((i=t.path.asFileHandler()).size=0,i.filename=i.path);var o={id:t.rid,data:i};t.root.observable.trigger("fileselect",o)}},t.refs.treeview.ontreedbclick=function(e){if(e&&0!=e.treepath){var i={id:t.rid,data:e};t.root.observable.trigger("filedbclick",i)}},t.root.observable.on("fileselect",function(e){e.id==t.rid&&(t.selectedFile=e.data,t.onfileselect&&t.onfileselect(e.data),$(t.refs.stbar).empty(),$(t.refs.stbar).append($("<span>").append("Selected: "+e.data.filename+" ("+e.data.size+" bytes)")))}),t.root.observable.on("filedbclick",function(e){e.id==t.rid&&("dir"!=e.data.type&&t.onfileopen?t.onfileopen(e.data):t.chdir&&"dir"==e.data.type&&t.chdir(e.data.path))}),o(),t.root.observable.on("resize",function(e){o()}),t.root.observable.on("calibrate",function(e){o()})})}),riot.tag2("afx-float-list",'<div ref="list"> <div each="{item,i in items}" class="{float_list_item:true, float_list_item_selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onmousedown="{parent._select}" oncontextmenu="{parent._select}"> <afx-label color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> </div> </div>',"",'ref="container"',function(e){this.items=e.items||[];var t=this;t.selidx=-1,t.onlistselect=e.onlistselect,t.onlistdbclick=e.onlistdbclick,t.fetch=void 0,this.root.observable=e.observable||riot.observable(),this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.dir=e.dir||"horizontal",t.root.set=function(e,i){if("selected"==e)-1!=t.selidx&&(t.items[t.selidx].selected=!1),-1==i?t.selidx=-1:t.items[i]&&(t.items[i].selected=!0);else if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;t.update()},t.root.get=function(e){return"selected"==e?-1==t.selidx?void 0:t.items[t.selidx]:t[e]},t.root.push=function(e,i){t.items.push(e),i&&t.update()},t.root.unshift=function(e,i){t.items.unshift(e),i&&t.update()},t.root.remove=function(e,i){var o=t.items.indexOf(e);o>=0&&(-1!=t.selidx&&(t.items[t.selidx].selected=!1,t.selidx=-1),t.items.splice(o,1),i&&t.update())},t.root.refresh=function(){i()},this.on("mount",function(){t.root.ready&&t.root.ready(t.root),i()});var i=function(){var e=20,i=20,s=$(t.refs.container).width(),r=$(t.refs.container).height();$(t.refs.list).children().each(function(n){$(this).unbind("mousedown"),o($(this));var a=$(this).width(),l=$(this).height();$(this).css("top",e+"px").css("left",i+"px"),"horizontal"==t.dir?(e+=l+20)>r&&(e=20,i+=a+20):(i+=a+20)>s&&(i=20,e+=l+20)})},o=function(e){var i=$(t.refs.container).offset();e.css("user-select","none").css("cursor","default").css("position","absolute").on("mousedown",function(t){t.preventDefault(),offset=e.offset(),offset.top=t.clientY-offset.top,offset.left=t.clientX-offset.left,$(window).on("mousemove",function(t){var o,s;o=t.clientY-offset.top-i.top,s=(s=t.clientX-i.top-offset.left)<0?0:s,o=o<0?0:o,e.css("top",o+"px").css("left",s+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})};this._autoselect=function(e,i){if(t.selidx==i)return!0;if(!e.selected||0==e.selected)return!1;var o={id:t.rid,data:e,idx:i};return t.selidx=i,t.onlistselect&&t.onlistselect(o),this.root.observable.trigger("listselect",o),!0}.bind(this),this._select=function(e){-1!=t.selidx&&t.selidx<t.items.length&&(t.items[t.selidx].selected=!1),e.item.item.selected=!0,t.update()}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item.item,idx:e.item.i},t.onlistdbclick&&t.onlistdbclick(data),t.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-grid-view",'<afx-grid-row ref="gridhead" rootid="{rid}" observable="{root.observable}" header="true" class="{grid_row_header:header}" if="{header}" cols="{header}"> </afx-grid-row> <div ref="scroller" style="width:100%; overflow:auto;"> <div ref="container" style="padding-bottom:10px"> <afx-grid-row each="{child, i in rows}" class="{selected: child.selected}" rootid="{parent.rid}" observable="{parent.root.observable}" index="{i}" cols="{child}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}" head="{parent.refs.gridhead}"></afx-grid-row> </div> </div>',"","",function(e){this.header=e.header,this.rows=e.rows||[];var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.selidx=-1,t.nrow=0,t.ongridselect=e.ongridselect,t.ongriddbclick=e.ongriddbclick,t.root.observable=e.observable,t.root.set=function(e,i){if("selected"==e)t._select({item:t.rows[i],preventDefault:function(){}});else if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;t.update()},this.calibrate_size=function(){t.header&&t.refs.gridhead?$(t.refs.scroller).css("height",$(t.root).height()-$(t.refs.gridhead.root).children().first().height()+"px"):$(t.refs.scroller).css("height",$(t.root).height()+"px")},t.root.get=function(e){return"selected"==e?-1==t.selidx?null:t.rows[t.selidx]:t[e]},this.on("mount",function(){t.refs.gridhead&&(t.refs.gridhead.observable=t.root.observable),$(t.refs.container).css("display","table").css("width","100%"),t.calibrate_size(),t.root.observable.on("resize",function(){t.root&&t.calibrate_size()})}),this.on("updated",function(){t.selidx>=t.rows.length&&(t.selidx=-1),t.nrow!=t.rows.length&&(t.nrow=t.rows.length,t.calibrate_size())}),this._select=function(e){var i={id:t.rid,data:e.item};t.ongridselect&&t.ongridselect(i),-1!=t.selidx&&(t.rows[t.selidx].selected=!1),t.selidx=e.item.i,t.rows[t.selidx].selected=!0,t.root.observable.trigger("gridselect",i),e.preventUpdate=!0,t.update()}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item},t.ongriddbclick&&t.ongriddbclick(data),t.root.observable.trigger("griddbclick",data)}.bind(this)}),riot.tag2("afx-grid-row",'<div riot-style="{!header? ⁗display: table-cell;⁗ :⁗⁗}" onclick="{parent._cell_select}" each="{child,i in cols}" class="{string:typeof child.value == ⁗string⁗, number: typeof child.value == ⁗number⁗, cellselected: parent._auto_cell_select(child,i)}"> <afx-label color="{child.color}" icon="{child.icon}" iconclass="{child.iconclass}" text="{child.value}"></afx-label> </div>',"","",function(opts){this.cols=opts.cols||[];var self=this;this.rid=opts.rootid,this.index=opts.index,this.header=eval(opts.header)||!1,this.head=opts.head,this.selidx=-1,self.observable=opts.observable,this.colssize=[];var update_header_size=function(){if(self.cols&&0!=self.cols.length){var e=$(self.root).parent().width();if(0!=e){var t=0,i=0;if(self.colssize=[],$.each(self.cols,function(e,o){o.width?(self.colssize.push(o.width),t+=o.width):(self.colssize.push(-1),i++)}),i>0){var o=parseInt((e-t)/i);$.each(self.colssize,function(e,t){-1==t&&(self.colssize[e]=o)})}calibrate_size()}}},calibrate_size=function(){var e=0;$(self.root).children().each(function(){$(this).css("width",self.colssize[e]+"px"),e++})};this.on("updated",function(){self.header?update_header_size():self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())}),this.on("mount",function(){self.header?($(self.root).css("display","flex").css("flex-direction","row"),update_header_size()):($(self.root).css("display","table-row").css("width","100%"),self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())),self.observable.on("gridcellselect",function(e){e.id==self.rid&&-1!=self.selidx&&e.row!=self.index&&(self.cols[self.selidx].selected=!1,self.selidx=-1)}),self.observable.on("resize",function(){self.update()})}),this._cell_select=function(e){self.header||(-1!=self.selidx&&(self.cols[self.selidx].selected=!1,self.selidx=-1),self.cols[e.item.i].selected=!0)}.bind(this),this._auto_cell_select=function(e,t){if(!e.selected||self.header)return!1;if(self.selidx==t)return!0;var i={id:self.rid,data:e,col:t,row:self.index};return self.selidx=t,self.observable.trigger("gridcellselect",i),!0}.bind(this)}),riot.tag2("afx-hbox",'<div ref="container" class="afx-hbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){$(t.refs.container).css("display","flex").css("flex-direction","row").css("width","100%"),i(),t.root.observable&&(t.root.observable.on("resize",function(e,t){i()}),t.root.observable.on("calibrate",function(){i()}))});var i=function(){var e,i,o=[],s=0;i=$(t.root).height(),avaiWidth=$(t.root).width(),$(t.refs.container).css("height",i+"px"),$(t.refs.container).children().each(function(e){this.observable=t.root.observable;var i=$(this).attr("data-width");if(i){if("grow"==i)return;"%"===i[i.length-1]&&(i=Number(i.slice(0,-1))*avaiWidth/100),$(this).css("width",i+"px"),s+=Number(i)}else $(this).css("flex-grow","1"),o.push(this)}),(e=(avaiWidth-s)/o.length)>0&&$.each(o,function(t,i){$(i).css("width",e+"px")}),t.root.observable.trigger("hboxchange",{id:t.rid,w:e,h:i})}}),riot.tag2("afx-label",'<span riot-style="{color?⁗color:⁗ + color:⁗⁗}"> <i if="{iconclass}" class="{iconclass}"></i> <i if="{icon}" class="icon-style" riot-style="{⁗background: url(⁗+icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> {text} </span>',"","",function(e){this.iconclass=e.iconclass,this.icon=e.icon,this.text=e.text,this.color=e.color;var t=this;this.on("update",function(){t.iconclass=e.iconclass,t.icon=e.icon,t.text=e.text,t.color=e.color}),t.root.set=function(i,o){if("*"==i)for(var s in o)e[s]=o[s];else e[i]=o;t.update()},t.root.get=function(e){return t[e]}}),riot.tag2("afx-list-view",'<div class="list-container" ref="container"> <div if="{opts.dropdown == ⁗true⁗}" ref="current" riot-style="{opts.width?⁗min-width:⁗ + opts.width + ⁗px;⁗:⁗min-width:150px;⁗}" onclick="{show_list}"> </div> <ul ref="mlist"> <li each="{item,i in items}" class="{selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}"> <afx-label color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> <i if="{item.closable}" class="closable" click="{parent._remove}"></i> <ul if="{item.complex}" class="complex-content"> <li each="{ctn,j in item.detail}" class="{ctn.class}">{ctn.text}</li> </ul> </li> </ul> </div>',"",'class="{dropdown: opts.dropdown == ⁗true⁗}"',function(e){this.items=e.items||[];var t=this;t.selidx=-1,t.onlistselect=e.onlistselect,t.onlistdbclick=e.onlistdbclick,t.onitemclose=e.onitemclose;var i=!1;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.root.set=function(e,i){if("selected"==e)-1!=t.selidx&&(t.items[t.selidx].selected=!1),-1==i?t.selidx=-1:t.items[i]&&(t.items[i].selected=!0);else if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;t.update()},t.root.get=function(e){return"selected"==e?-1!=t.selidx?t.items[t.selidx]:void 0:"count"==e?t.items.length:t[e]},t.root.push=function(e,i){t.items.push(e),i&&t.update()},t.root.unshift=function(e,i){t.items.unshift(e),i&&t.update()},t.root.replaceItem=function(e,i,o){var s=t.items.indexOf(e);s>=0&&(t.items[s]=i,o&&t.update())},t.root.remove=function(e,o){var s=t.items.indexOf(e);s>=0&&(-1!=t.selidx&&(t.items[t.selidx].selected=!1,t.selidx=-1),t.items.splice(s,1),o&&t.update(),i=!0)},e.observable?this.root.observable=e.observable:this.root.observable=riot.observable(),this.on("mount",function(){"true"==e.dropdown&&($(document).click(function(e){$(e.target).closest(t.refs.container).length||$(t.refs.mlist).hide()}),$(t.refs.container).css("position","absolute").css("display","inline-block"),$(t.refs.mlist).css("position","absolute").css("display","none").css("top","100%").css("left","0"),t.root.observable.on("vboxchange",function(e){e.id==t.parent.rid&&$(t.refs.container).css("width",$(t.root).parent().innerWidth()+"px")}))}),this.show_list=function(e){var i=$("#desktop").height();$(t.root).offset().top+$(t.refs.mlist).height()>i?$(t.refs.mlist).css("top","-"+$(t.refs.mlist).outerHeight()+"px"):$(t.refs.mlist).css("top","100%"),$(t.refs.mlist).show(),e.preventUpdate=!0}.bind(this),this._remove=function(e){r=!0,t.onitemclose&&(r=t.onitemclose(e)),r&&t.root.remove(e.item.item,!0)}.bind(this),this._autoselect=function(i,o){if(!i.selected||0==i.selected)return!1;if(t.selidx==o)return!0;var s={id:t.rid,data:i,idx:o};return t.selidx=o,"true"==e.dropdown&&($(t.refs.mlist).hide(),$(t.refs.current).html(i.text)),t.onlistselect&&t.onlistselect(s),this.root.observable.trigger("listselect",s),!0}.bind(this),this._select=function(e){if(i)return i=!1,void(e.preventUpdate=!0);-1!=t.selidx&&t.selidx<t.items.length&&(t.items[t.selidx].selected=!1),e.item.item.selected=!0}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item.item,idx:e.item.i},t.onlistdbclick&&t.onlistdbclick(data),t.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-menu",'<ul class="{context: opts.context == ⁗true⁗}"> <li class="afx-corner-fix"></li> <li ref="container" each="{data,i in items}" class="{afx_submenu:data.child != null && data.child.length > 0, fix_padding:data.icon}" no-reorder> <a href="#" onclick="{parent.onselect}"> <afx-switch if="{data.switch || data.radio}" class="{checked:parent.checkItem(data)}" enable="false" swon="{data.checked}"></afx-switch> <afx-label color="{data.color}" iconclass="{data.iconclass}" icon="{data.icon}" text="{data.text}"></afx-label> <span if="{data.shortcut}" class="shortcut">{data.shortcut}</span> </a> <afx-menu if="{data.child != null && data.child.length > 0}" child="{data.child}" onmenuselect="{data.onmenuselect}" observable="{parent.root.observable}" rootid="{parent.rid}"></afx-menu> </li> <li class="afx-corner-fix"></li> </ul>',"","",function(e){var t;this.items=e.child||[];var i=void 0;e.rootid?(this.rid=e.rootid,t=!1):(this.rid=$(this.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t=!0);var o=this;this.onmenuselect=e.onmenuselect,this.checkItem=function(e){return 1==e.checked&&e.radio&&(i&&(i.checked=!1),(i=e).checked=!0),!1}.bind(this),o.root.set=function(e,t){if("*"==e)for(var i in t)o[i]=t[i];else o[e]=t;o.update()},o.root.push=function(e,t){o.items.push(e),t&&o.update()},o.root.unshift=function(e,t){o.items.unshift(e),t&&o.update()},o.root.remove=function(e,t){var i=o.items.indexOf(e);i>=0&&o.items.splice(i,1),t&&o.update()},o.root.update=function(){o.update()},o.root.get=function(e){return o[e]},o.root.show=function(t){"true"==e.context&&($(o.root).css("top",t.clientY-15+"px").css("left",t.clientX-5+"px").show(),$(document).on("click",s))},e.observable?this.root.observable=e.observable:(this.root.observable=riot.observable(),this.root.observable.on("menuselect",function(t){if(o.onmenuselect&&o.onmenuselect(t),"true"==e.context)$(o.root).hide();else if(!t.root&&o.refs.container){var i=o.refs.container.length?o.refs.container:[o.refs.container];for(var s in i)$("afx-menu",i[s]).first().hide()}}));var s=function(t){if("true"!=e.context){if(!$(t.target).closest(o.refs.container).length&&o.refs.container){var i=o.refs.container.length?o.refs.container:[o.refs.container];for(var r in i)$("afx-menu",i[r]).first().hide();$(document).unbind("click",s)}else if(o.refs.container&&o.refs.container.length)for(var r in o.refs.container)$(t.target).closest(o.refs.container[r]).length||$("afx-menu",o.refs.container[r]).first().hide()}else $(t.target).closest(o.root).length||($(o.root).hide(),$(document).unbind("click",s))};this.onselect=function(r){var n={id:o.rid,root:t,e:r,item:r.item};if(r.item.data.switch?r.item.data.checked=!r.item.data.checked:r.item.data.radio&&(i&&(i.checked=!1),r.item.data.checked=!0,i=r.item.data),this.root.observable.trigger("menuselect",n),this.onmenuselect&&!t&&this.onmenuselect(n),r.preventDefault(),$(document).unbind("click",s),"true"!=e.context)return t&&o.refs.container?(o.refs.container.length?$("afx-menu",o.refs.container[r.item.i]).first().show():$("afx-menu",o.refs.container).first().show(),void $(document).on("click",s)):void 0}.bind(this)}),riot.tag2("afx-overlay","<yield></yield>","","",function(e){this.width=e.width||200,this.height=e.height||400;var t=this;t.commander=null,this.root.observable=e.observable||riot.observable();var i=$(t.root).attr("data-id"),o=function(){$(t.root).css("width",t.width+"px").css("height",t.height+"px"),t.root.observable.trigger("resize",{id:i,w:t.width,h:t.height})};t.root.set=function(e,i){if("*"==e)for(var s in i)t[s]=i[s];else t[e]=i;"width"!=e&&"height"!=e||o(),t.update()},t.root.get=function(e){return t[e]},t.on("mount",function(){$(t.root).css("position","absolute"),$(t.root).children().each(function(e){this.observalbe=t.root.observalbe}),o(),t.root.observable.trigger("rendered",t.root)})}),riot.tag2("afx-resizer","","","",function(e){var t=this;t.dir="hz",t.resizable=void 0,t.parent=void 0,t.minsize=0,t.on("mount",function(){var e=$(t.parent.root).prop("tagName");t.resizable=1==$(t.root).prev().length?$(t.root).prev()[0]:void 0,"AFX-HBOX"==e?(t.dir="hz",$(t.root).css("cursor","col-resize"),t.resizable&&(t.minsize=parseInt($(t.resizable).attr("min-width")))):"AFX-VBOX"==e?(t.dir="ve",$(t.root).css("cursor","row-resize"),t.resizable&&(t.minsize=parseInt($(t.resizable).attr("min-height")))):t.dir="none",i()});var i=function(){$(t.root).css("user-select","none"),$(t.root).on("mousedown",function(e){e.preventDefault(),$(window).on("mousemove",function(e){t.resizable&&("hz"==t.dir?o(e):"ve"==t.dir&&s(e))}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},o=function(e){if(t.resizable){var i=$(t.resizable).offset();w=Math.round(e.clientX-i.left),w<t.minsize&&(w=t.minsize),$(t.resizable).attr("data-width",w.toString()),t.parent.root.observable.trigger("calibrate",t.resizable)}},s=function(e){if(t.resizable){var i=$(t.resizable).offset();h=Math.round(e.clientY-i.top),h<t.minsize&&(h=minsize),$(t.resizable).attr("data-height",h.toString()),t.parent.root.observable.trigger("calibrate",t.resizable)}}}),riot.tag2("afx-switch",'<span class="{swon: swon}" onclick="{toggle}"></span>',"","",function(e){null!=e.swon?this.swon=e.swon:this.swon=!1;var t=this;this.root.observable=e.observable,null!=e.enable?this.enable=e.enable:this.enable=!0,this.onchange=e.onchange,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.root.set=function(i,o){if("*"==i)for(var s in o)e[s]=o[s];else e[i]=o;t.update()},t.root.get=function(e){return t[e]},this.root.toggle=function(){e.swon=!t.swon,t.update()},this.on("update",function(i){t.swon=e.swon,t.onchange=e.onchange}),this.toggle=function(i){if(t.enable){e.swon=!t.swon;var o={id:t.rid,data:e.swon};t.onchange&&t.onchange(o),t.root.observable&&t.root.observable.trigger("switch",o)}}.bind(this)}),riot.tag2("afx-sys-panel",'<div> <afx-menu data-id="os_menu" ref="aOsmenu" child="{osmenu.child}" onmenuselect="{osmenu.onmenuselect}" class="afx-panel-os-menu"></afx-menu> <afx-menu data-id="appmenu" ref="aAppmenu" child="{appmenu.child}" class="afx-panel-os-app"></afx-menu> <afx-menu data-id="sys_tray" ref="aTray" child="{systray.child}" onmenuselect="{systray.onmenuselect}" class="afx-panel-os-stray"></afx-menu> </div>',"","",function(e){this.osmenu={child:[]},this.appmenu={child:[]},this.systray={child:[],onmenuselect:function(e){e.root&&e.e.item.data.awake(e.e)}};var t=this;t.root.attachservice=function(e){t.refs.aTray.root.unshift(e,!0),e.attach(t.refs.aTray)},t.root.detachservice=function(e){t.refs.aTray.root.remove(e,!0)},t.root.set=function(e,i){if("*"==e)for(var o in i)t[o]=i[o];else t[e]=i;t.update()},t.root.get=function(e){return t[e]},this.on("mount",function(){$(t.refs.aOsmenu.root).css("z-index",1e6),$(t.refs.aAppmenu.root).css("z-index",1e6),$(t.refs.aTray.root).css("z-index",1e6),window.OS.courrier.trigger("syspanelloaded")})}),riot.tag2("afx-tab-container",'<afx-list-view ref="list"></afx-list-view>',"","",function(e){var t=this;this.closable=e.closable||!1,t.root.observable=e.observable||riot.observable(),t.ontabselect=e.ontabselect,this.get_observable=function(){return t.root.observable}.bind(this),t.root.get=function(e){return t.refs.list.root.get(e)},t.root.update=function(){t.update(!0)},t.on("mount",function(){t.refs.list.root.observable=t.root.observable,t.refs.list.root.set("onlistselect",function(e){t.root.observable.trigger("tabselect",e),t.ontabselect&&t.ontabselect(e)})}),t.root.set=function(e,i){if("*"==e)for(var o in i)t.refs.list.root.set(o,i[o]);else if("closable"==e)t.closable=i;else if("ontabselect"==e)t.ontabselect=i;else{if("items"==e)for(var o in i)i[o].closable=t.closable;t.refs.list.root.set(e,i)}},t.root.push=function(e,i){e.closable=t.closable,t.refs.list.root.push(e,i)},t.root.replaceItem=function(e,i,o){i.closable=t.closable,t.refs.list.root.replaceItem(e,i,o)},t.root.unshift=function(e,i){t.refs.list.root.unshift(e,i)},t.root.remove=function(e,i){t.refs.list.root.remove(e,i)}}),riot.tag2("afx-tree-view",'<div class="{afx_tree_item_selected:treeroot.selectedItem && treeroot.selectedItem.treepath == data.treepath, afx_folder_item: isFolder(), afx_tree_item_odd: index%2 != 0}" onclick="{select}" ondblclick="{_dbclick}" oncontextmenu="{select}"> <ul style="padding:0;margin:0;white-space: nowrap;"> <li ref="padding"></li> <li class="itemname" style="display:inline-block;"> <i if="{!isFolder() && data.iconclass}" class="{data.iconclass}"></i> <i if="{!isFolder() && data.icon}" class="icon-style" riot-style="{⁗background: url(⁗+data.icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> <span onclick="{toggle}" if="{isFolder()}" class="{open ? \'afx-tree-view-folder-open\' : \'afx-tree-view-folder-close\'}"></span> {data.name} </li> </ul> </div> <ul if="{isFolder()}" show="{isFolder() && open}"> <li each="{child, i in data.nodes}"> <afx-tree-view ontreeselect="{parent.ontreeselect}" index="{i}" fetch="{parent.fetch}" ontreedbclick="{parent.ontreedbclick}" data="{child}" indent="{indent+1}" observable="{parent.root.observable}" path="{parent.data.treepath + ⁗>⁗ + i}" treeroot="{parent.treeroot}"></afx-tree-view> </li> </ul>',"","",function(e){var t=this;t.open=!0,t.data={name:"",nodes:null,treepath:e.path,i:-1},e.data&&(t.data=e.data,t.open=null==e.data.open||e.data.open),t.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.data.rid=t.rid,t.data.i=e.index,t.ontreeselect=e.ontreeselect,t.ontreedbclick=e.ontreedbclick,t.fetch=e.fetch,t.indent=e.indent||0;var i=!1;e.treeroot?(this.treeroot=e.treeroot,this.treeroot.counter++):(this.treeroot=t,this.treeroot.counter=0),t.data.treepath=e.path||0,t.selectedItem=null,t.index=this.treeroot.counter;var o=function(e,t,i,s){if(t[i]==s)return e.push(t);if(t.nodes&&t.nodes.length>0)for(var r in t.nodes)o(e,t.nodes[r],i,s)};t.root.find=function(e,i){var s=[];return o(s,t.data,e,i),s},t.root.set=function(e,i){if("*"==e)for(var o in i)t[o]=i[o];else if("data"==e)for(var o in i)t.data[o]=i[o];else"selectedItem"==e?(t.ontreeselect&&t.ontreeselect(t.data),t.treeroot.selectedItem=i,t.root.observable.trigger("treeselect",t.data)):t[e]=i;t.update()},t.root.get=function(e){return t[e]},e.observable?this.root.observable=e.observable:this.root.observable=riot.observable(),this.on("mount",function(){$(t.refs.padding).css("display","inline-block").css("height","1px").css("padding",0).css("margin",0).css("background-color","transparent").css("width",15*t.indent+"px")}),this.isFolder=function(){return t.data.nodes}.bind(this),this.toggle=function(e){t.open=!t.open,e.preventDefault(),i=!0,t.open&&0==t.data.nodes.length&&t.fetch&&t.fetch(e.item,function(e){t.data.nodes=e,t.update()})}.bind(this),this.select=function(e){i?i=!1:(t.ontreeselect&&t.ontreeselect(t.data),t.treeroot.selectedItem=t.data,this.root.observable.trigger("treeselect",t.data),e.preventUpdate=!0,t.treeroot.update(),e.preventDefault())}.bind(this),this._dbclick=function(e){i?i=!1:(t.ontreedbclick&&t.ontreedbclick(t.data),t.root.observable.trigger("treedbclick",t.data))}.bind(this)}),riot.tag2("afx-vbox",'<div ref="container" class="afx-vbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){$(t.refs.container).css("display","flex").css("flex-direction","column").css("width","100%"),i(),t.root.observable&&(t.root.observable.on("resize",function(e,t){i()}),t.root.observable.on("calibrate",function(){i()}))});var i=function(){var e,i,o=[],s=0;i=$(t.root).height(),avaiwidth=$(t.root).width(),$(t.refs.container).css("height",i+"px"),$(t.refs.container).children().each(function(e){this.observable=t.root.observable;var r=$(this).attr("data-height");if(r){if("grow"==r)return;"%"===r[r.length-1]&&(r=Number(r.slice(0,-1))*i/100),$(this).css("height",r+"px"),s+=Number(r)}else $(this).css("flex-grow","1"),o.push(this)}),(e=(i-s)/o.length)>0&&$.each(o,function(t,i){$(i).css("height",e+"px")}),t.root.observable.trigger("vboxchange",{id:t.rid,w:avaiwidth,h:e})}});