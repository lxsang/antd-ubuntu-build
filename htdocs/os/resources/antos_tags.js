riot.tag2("afx-app-window",'<div class="afx-window-wrapper"> <ul class="afx-window-top"> <li class="afx-window-close" onclick="{close}"></li> <li if="{minimizable == true}" class="afx-window-minimize" onclick="{minimize}"></li> <li if="{resizable == true}" class="afx-window-maximize" onclick="{maximize}"></li> <li ref="dragger" class="afx-window-title">{apptitle?apptitle.__():apptitle}</li> </ul> <div class="afx-clear"></div> <div ref="content" class="afx-window-content"> <yield></yield> </div> <div if="{resizable == true}" ref="grip" class="afx-window-grip"> </div>',"",'ref="window"',function(opts){this.apptitle=opts.apptitle||"",null==opts.minimizable?this.minimizable=!0:this.minimizable=eval(opts.minimizable),null==opts.resizable?this.resizable=!0:this.resizable=eval(opts.resizable);var self=this,offset={top:0,left:0},desktop_pos=$("#desktop").offset(),isMaxi=!1,history={},width=opts.width||400,height=opts.height||300;this.root.observable=opts.observable||riot.observable(),window._zindex||(window._zindex=10),this.shown=!1,self.root.contextmenuHandler=function(e){},self.root.set=function(e,t){if("*"==e)for(var o in t)self[o]=t[o];else self[e]=t;self.update()},self.root.get=function(e){return self[e]},self.root.update=function(){self.update()},this.minimize=function(){this.root.observable.trigger("hide")}.bind(this),this.close=function(){this.root.observable.trigger("exit")}.bind(this),this.on("mount",function(){var e,t;e=($("#desktop").width()-width)/2,t=($("#desktop").height()-height)/2,$(self.refs.window).css("position","absolute").css("left",e+"px").css("top",t+"px").css("width",width+"px").css("height",height+"px").css("z-index",window._zindex++),$(self.refs.window).on("mousedown",function(e){0==self.shown&&self.root.observable.trigger("focus")}),$(self.refs.window).click(function(e){}),enable_dragging(),self.resizable&&enable_resize(),$(self.refs.dragger).dblclick(function(e){toggle_window()}),$(self.refs.content).children().each(function(e){this.observable=self.root.observable});var o=function(){var e=$(self.refs.content).height()/$(self.refs.content).children().length;$(self.refs.content).children().each(function(t){$(this).css("height",e+"px")})};o(),self.root.observable.on("resize",function(){o()}),self.root.observable.on("focus",function(){window._zindex++,$(self.refs.window).show().css("z-index",window._zindex).removeClass("unactive"),self.shown=!0}),self.root.observable.on("blur",function(){self.shown=!1,$(self.refs.window).addClass("unactive")}),self.root.observable.on("hide",function(){$(self.refs.window).hide(),self.shown=!1}),self.root.observable.on("toggle",function(){self.shown?self.root.observable.trigger("hide"):self.root.observable.trigger("focus")}),self.root.observable.trigger("rendered",self.root)});var enable_dragging=function(){$(self.refs.dragger).css("user-select","none").css("cursor","default"),$(self.refs.dragger).on("mousedown",function(e){e.preventDefault(),(offset=$(self.refs.window).offset()).top=e.clientY-offset.top,offset.left=e.clientX-offset.left,$(window).on("mousemove",function(e){var t,o;isMaxi?(toggle_window(),t=0,letf=e.clientX-$(self.refs.window).width()/2,offset.top=10,offset.left=$(self.refs.window).width()/2):(t=e.clientY-offset.top-desktop_pos.top,o=(o=e.clientX-desktop_pos.top-offset.left)<0?0:o,t=t<0?0:t),$(self.refs.window).css("top",t+"px").css("left",o+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},enable_resize=function(){self.resizable&&($(self.refs.grip).css("user-select","none").css("cursor","default").css("position","absolute").css("bottom","0").css("right","0").css("cursor","nwse-resize"),$(self.refs.grip).on("mousedown",function(e){e.preventDefault(),offset.top=e.clientY,offset.left=e.clientX,$(window).on("mousemove",function(e){var t,o;t=(t=$(self.refs.window).width()+e.clientX-offset.left)<100?100:t,o=(o=$(self.refs.window).height()+e.clientY-offset.top)<100?100:o,offset.top=e.clientY,offset.left=e.clientX,$(self.refs.window).css("width",t+"px").css("height",o+"px"),isMaxi=!1,self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:t,h:o})}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})}))},toggle_window=function(){var e,t;self.resizable&&(0==isMaxi?(history={top:$(self.refs.window).css("top"),left:$(self.refs.window).css("left"),width:$(self.refs.window).css("width"),height:$(self.refs.window).css("height")},e=$("#desktop").width()-5,t=$("#desktop").height()-10,$(self.refs.window).css("width",e+"px").css("height",t+"px").css("top","0").css("left","0"),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:e,h:t}),isMaxi=!0):(isMaxi=!1,$(self.refs.window).css("width",history.width).css("height",history.height).css("top",history.top).css("left",history.left),self.root.observable.trigger("resize",{id:$(self.root).attr("data-id"),w:history.width,h:history.height})))};this.maximize=function(){toggle_window()}.bind(this)}),riot.tag2("afx-apps-dock",'<afx-button class="{selected: parent.selectedApp && app.pid == parent.selectedApp.pid}" each="{items}" icon="{icon}" text="{text}" onbtclick="{onbtclick}"> </afx-button>',"","",function(e){this.items=e.items||[];var t=this;t.selectedApp=null,t.root.set=function(e,o){if("*"==e)for(var i in o)t[i]=o[i];else if(t[e]=o,"selectedApp"==e){for(var i in t.items)t.items[i].app.blur();o&&$("#desktop")[0].set("selected",-1)}t.update()},t.root.newapp=function(e){for(var e in t.items.push(e),t.selectedApp=e.app,t.update(),t.items)t.items[e].app.blur()},t.root.removeapp=function(e){var o=-1;for(var i in t.items)if(t.items[i].app.pid==e.pid){o=i;break}-1!=o&&(delete t.items[o].app,t.items.splice(o,1),t.update())},t.root.get=function(e){return t[e]},this.on("mount",function(){window.OS.courrier.trigger("sysdockloaded")})}),riot.tag2("afx-button",'<button disabled="{enable == ⁗false⁗}" onclick="{_onbtclick}" ref="mybtn"> <afx-label color="{color}" icon="{icon}" iconclass="{iconclass}" text="{text}"></afx-label> </button>',"","",function(opts){this.enable=opts.enable,this.icon=opts.icon,this.iconclass=opts.iconclass,this.color=opts.color,this.text=opts.text||"";var self=this;this.onbtclick=opts.onbtclick,self.root.set=function(e,t){if("*"==e)for(var o in t)self[o]=t[o];else self[e]=t;self.update()},self.root.trigger=function(){$(self.refs.mybtn).trigger("click")},self.root.get=function(e){return self[e]},this._onbtclick=function(e){"string"==typeof self.onbtclick?eval(self.onbtclick):self.onbtclick&&self.onbtclick(e),self.root.observable&&self.root.observable.trigger("btclick",{id:$(self.root).attr("data-id"),data:self.root})}}),riot.tag2("afx-calendar-view",'<div><i class="prevmonth" onclick="{prevmonth}"></i> <afx-label text="{mtext}"></afx-label> <afx-label text="{year}"></afx-label> <i onclick="{nextmonth}" class="nextmonth"></i></div> <afx-grid-view data-id="{⁗grid_⁗ + rid}" style="height:100%;" ref="grid" header="{header}"> </afx-grid-view>',"","",function(e){this.header=[{value:"__(Sun)"},{value:"__(Mon)"},{value:"__(Tue)"},{value:"__(Wed)"},{value:"__(Thu)"},{value:"__(Fri)"},{value:"__(Sat)"}],this.root.observable=e.observable;var t=this;this.day=0,this.month=0,this.year=0,this.ondayselect=e.ondayselect,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.selectedDate=void 0,t.root.get=function(e){return t[e]},this.on("mount",function(e){t.refs.grid.root.observable=t.root.observable,o(null),t.root.observable.on("gridcellselect",function(e){if(e.id=="grid_"+t.rid&&""!=e.data.value){var o={id:t.rid,data:new Date(t.year,t.month,e.data.value)};t.ondayselect&&t.ondayselect(o),t.selectedDate=o.data,t.root.observable.trigger("dayselect",o)}})}),this.prevmonth=function(){t.selectedDate=void 0,this.month--,this.month<0&&(this.month=11,this.year--),o(new Date(this.year,this.month,1))}.bind(this),this.nextmonth=function(){t.selectedDate=void 0,this.month++,this.month>11&&(this.month=0,this.year++),o(new Date(this.year,this.month,1))}.bind(this);var o=function(e){null===e&&(e=new Date),t.day=e.getDate(),t.month=e.getMonth(),t.year=e.getFullYear();var o=(new Date).getDate(),i=(new Date).getMonth(),s=(new Date).getFullYear();months=["__(January)","__(February)","__(March)","__(April)","__(May)","__(June)","__(July)","__(August)","__(September)","__(October)","__(November)","__(December)"],this_month=new Date(t.year,t.month,1),next_month=new Date(t.year,t.month+1,1),first_week_day=this_month.getDay(),days_in_this_month=Math.round((next_month.getTime()-this_month.getTime())/864e5),t.mtext=months[t.month];var r=[],n=[];for(week_day=0;week_day<first_week_day;week_day++)n.push({value:""});for(week_day=first_week_day,day_counter=1;day_counter<=days_in_this_month;day_counter++)week_day%=7,0==week_day&&(r.push(n),n=[]),o==day_counter&&t.month==i&&t.year==s?n.push({value:day_counter,selected:!0}):n.push({value:day_counter}),week_day++;for(var a=0;a<=7-n.length;a++)n.push({value:""});r.push(n),t.refs.grid.root.set("rows",r)}}),riot.tag2("afx-color-picker",'<div style="width:310px; height:190px;display:block; padding:3px;"> <canvas class="color-palette" width="284" height="155" style="float:left;" ref="palette"></canvas> <div class="color-sample" style="width:15px; height:155px; text-align:center; margin-left:3px; display:block;float:left;" ref="colorval"></div> <div class="afx-clear"></div> <div style="margin-top:3px;"> <span>Hex:</span><input type="text" ref="hextext" style="width:70px; margin-left:3px;margin-right:5px;"></input> <span ref="rgbtext"></span> </div> </div>',"","",function(e){var t=this,o=void 0;t.root.observable=e.observable,t.oncolorsetect=e.oncolorsetect,t.selectedColor=void 0,t.root.set=function(e,o){if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;t.update()},t.root.get=function(e){return t[e]};this.on("mount",function(){!function(){var e=(o=$(t.refs.palette).get(0).getContext("2d")).createLinearGradient(0,0,$(t.refs.palette).width(),0);e.addColorStop(0,"rgb(255,   0,   0)"),e.addColorStop(.15,"rgb(255,   0, 255)"),e.addColorStop(.33,"rgb(0,     0, 255)"),e.addColorStop(.49,"rgb(0,   255, 255)"),e.addColorStop(.67,"rgb(0,   255,   0)"),e.addColorStop(.84,"rgb(255, 255,   0)"),e.addColorStop(1,"rgb(255,   0,   0)"),e.addColorStop(0,"rgb(0,   0,   0)"),o.fillStyle=e,o.fillRect(0,0,o.canvas.width,o.canvas.height),(e=o.createLinearGradient(0,0,0,$(t.refs.palette).width())).addColorStop(0,"rgba(255, 255, 255, 1)"),e.addColorStop(.5,"rgba(255, 255, 255, 0)"),e.addColorStop(.5,"rgba(0,     0,   0, 0)"),e.addColorStop(1,"rgba(0,     0,   0, 1)"),o.fillStyle=e,o.fillRect(0,0,o.canvas.width,o.canvas.height);var i=function(e){return s=e.toString(16),1==s.length&&(s="0"+s),s},r=function(e){$(t.refs.palette).css("cursor","crosshair");var s=$(t.refs.palette).offset(),r=e.pageX-s.left,n=e.pageY-s.top,a=o.getImageData(r,n,1,1);return{r:a.data[0],g:a.data[1],b:a.data[2],text:"rgb("+a.data[0]+", "+a.data[1]+", "+a.data[2]+")",hex:"#"+i(a.data[0])+i(a.data[1])+i(a.data[2])}},n=function(e){var o=r(e);$(t.refs.colorval).css("background-color",o.text)};$(t.refs.palette).mouseenter(function(e){$(t.refs.palette).on("mousemove",n)}),$(t.refs.palette).mouseout(function(e){$(t.refs.palette).unbind("mousemove",n),t.selectedColor&&$(t.refs.colorval).css("background-color",t.selectedColor.text)}),$(t.refs.palette).on("click",function(e){data=r(e),$(t.refs.rgbtext).html(data.text),$(t.refs.hextext).val(data.hex),t.selectedColor=data,t.oncolorsetect&&t.oncolorsetect(data),t.root.observable&&t.root.observable.trigger("colorselect",data)})}()})}),riot.tag2("afx-dummy","<yield></yield>","","",function(e){var t=this;t.root.update=function(){t.update()}}),riot.tag2("afx-file-view",'<afx-list-view ref="listview" observable="{root.observable}"></afx-list-view> <afx-grid-view ref="gridview" header="{header}" observable="{root.observable}"></afx-grid-view> <div class="treecontainer" ref="treecontainer"> <afx-tree-view ref="treeview" observable="{root.observable}"></afx-tree-view> </div> <afx-label if="{status == true}" class="status" ref="stbar"></afx-label>',"","",function(e){var t=this;t.root.observable=e.observable||riot.observable(),t.view=e.view||"list",t.data=e.data||[],t.path=e.path||"home:///",t.onfileselect,t.onfileopen,this.status=null==e.status||e.status,this.selectedFile=void 0,this.showhidden=e.showhidden,this.preventUpdate=!1,this.fetch=e.fetch,this.chdir=e.chdir,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.header=[{value:"__(File name)"},{value:"__(Type)",width:150},{value:"__(Size)",width:70}],t.root.set=function(e,o){if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;"view"==e&&n(),"data"==e&&(t.selectedFile=void 0),"preventUpdate"!=e&&t.update()},t.root.get=function(e){return t[e]};var o=function(e,t){return e.type<t.type?-1:e.type>t.type?1:0},i=function(){var e=$(t.root).outerHeight(),o=$(t.root).width();t.refs.stbar&&(e-=$(t.refs.stbar.root).height()+10),$(t.refs.listview.root).css("height",e+"px"),$(t.refs.gridview.root).css("height",e+"px"),$(t.refs.treecontainer).css("height",e+"px"),$(t.refs.listview.root).css("width",o+"px"),$(t.refs.gridview.root).css("width",o+"px"),$(t.refs.treecontainer).css("width",o+"px")},s=function(e){return nodes=[],$.each(e,function(e,o){("."!=o.filename[0]||t.showhidden)&&(o.name=o.filename,"dir"==o.type&&(o.nodes=[],o.open=!1),o.iconclass=o.iconclass?o.iconclass:o.type,o.icon=o.icon,nodes.push(o))}),nodes},r=function(){var e,i;t.data.sort(o),"icon"==t.view?(i=[],$.each(t.data,function(e,o){("."!=o.filename[0]||t.showhidden)&&(o.text=o.filename,o.text.length>10&&(o.text=o.text.substring(0,9)+"..."),o.iconclass=o.iconclass?o.iconclass:o.type,o.icon=o.icon,i.push(o))}),t.refs.listview.root.set("items",i)):"list"==t.view?(e=[],$.each(t.data,function(o,i){if("."!=i.filename[0]||t.showhidden){var s=[{value:i.filename,iconclass:i.iconclass?i.iconclass:i.type,icon:i.icon},{value:i.mime},{value:i.size},{idx:o}];e.push(s)}}),t.refs.gridview.root.set("rows",e)):function(){t.refs.treeview.root.set("selectedItem",null);var e={};e.name=t.path,e.nodes=s(t.data),t.refs.treeview.root.set("data",e)}()},n=function(){switch($(t.refs.listview.root).hide(),$(t.refs.gridview.root).hide(),$(t.refs.treecontainer).hide(),t.selectedFile=void 0,t.refs.listview.root.set("selected",-1),t.refs.treeview.selectedItem=void 0,t.refs.treeview.root.set("fetch",function(e,o){t.fetch&&t.fetch(e,function(e){o(s(e))})}),t.refs.stbar&&t.refs.stbar.root.set("text",""),t.view){case"icon":$(t.refs.listview.root).show();break;case"list":$(t.refs.gridview.root).show();break;case"tree":$(t.refs.treecontainer).show()}i()};t.on("updated",function(){t.preventUpdate?t.preventUpdate=!1:r()}),t.on("mount",function(){n(),t.refs.listview.onlistselect=function(e){e.id=t.rid,t.root.observable.trigger("fileselect",e)},t.refs.listview.onlistdbclick=function(e){e.id=t.rid,t.root.observable.trigger("filedbclick",e)},t.refs.gridview.root.observable=t.root.observable,t.refs.gridview.ongridselect=function(e){var o={id:t.rid,data:t.data[e.data.child[3].idx],idx:e.data.child[3].idx};t.root.observable.trigger("fileselect",o)},t.refs.gridview.ongriddbclick=function(e){var o={id:t.rid,data:t.data[e.data.child[3].idx],idx:e.data.child[3].idx};t.root.observable.trigger("filedbclick",o)},t.refs.treeview.ontreeselect=function(e){if(e){var o=e;0==e.treepath&&((o=t.path.asFileHandler()).size=0,o.filename=o.path);var i={id:t.rid,data:o};t.root.observable.trigger("fileselect",i)}},t.refs.treeview.ontreedbclick=function(e){if(e&&0!=e.treepath){var o={id:t.rid,data:e};t.root.observable.trigger("filedbclick",o)}},t.root.observable.on("fileselect",function(e){e.id==t.rid&&(t.selectedFile=e.data,t.onfileselect&&t.onfileselect(e.data),t.refs.stbar&&t.refs.stbar.root.set("text",__("Selected: {0} ({1} bytes)",e.data.filename,e.data.size?e.data.size:"0")))}),t.root.observable.on("filedbclick",function(e){e.id==t.rid&&("dir"!=e.data.type&&t.onfileopen?t.onfileopen(e.data):t.chdir&&"dir"==e.data.type&&t.chdir(e.data.path))}),i(),t.root.observable.on("resize",function(e){i()}),t.root.observable.on("calibrate",function(e){i()})})}),riot.tag2("afx-float-list",'<div ref="list"> <div each="{item,i in items}" class="{float_list_item:true, float_list_item_selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onmousedown="{parent._select}" oncontextmenu="{parent._select}"> <afx-label color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> </div> </div>',"",'ref="container"',function(e){this.items=e.items||[];var t=this;t.selidx=-1,t.onlistselect=e.onlistselect,t.onlistdbclick=e.onlistdbclick,t.fetch=void 0,this.root.observable=e.observable||riot.observable(),this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.dir=e.dir||"horizontal",t.root.set=function(e,o){if("selected"==e)-1!=t.selidx&&(t.items[t.selidx].selected=!1),-1==o?t.selidx=-1:t.items[o]&&(t.items[o].selected=!0);else if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;t.update()},t.root.get=function(e){return"selected"==e?-1==t.selidx?void 0:t.items[t.selidx]:t[e]},t.root.push=function(e,o){t.items.push(e),o&&t.update()},t.root.unshift=function(e,o){t.items.unshift(e),o&&t.update()},t.root.remove=function(e,o){var i=t.items.indexOf(e);i>=0&&(-1!=t.selidx&&(t.items[t.selidx].selected=!1,t.selidx=-1),t.items.splice(i,1),o&&t.update())},t.root.refresh=function(){o()},this.on("mount",function(){t.root.ready&&t.root.ready(t.root),o()});var o=function(){var e=20,o=20,s=$(t.refs.container).width(),r=$(t.refs.container).height();$(t.refs.list).children().each(function(n){$(this).unbind("mousedown"),i($(this));var a=$(this).width(),l=$(this).height();$(this).css("top",e+"px").css("left",o+"px"),"horizontal"==t.dir?(e+=l+20)>r&&(e=20,o+=a+20):(o+=a+20)>s&&(o=20,e+=l+20)})},i=function(e){var o=$(t.refs.container).offset();e.css("user-select","none").css("cursor","default").css("position","absolute").on("mousedown",function(t){t.preventDefault(),offset=e.offset(),offset.top=t.clientY-offset.top,offset.left=t.clientX-offset.left,$(window).on("mousemove",function(t){var i,s;i=t.clientY-offset.top-o.top,s=(s=t.clientX-o.top-offset.left)<0?0:s,i=i<0?0:i,e.css("top",i+"px").css("left",s+"px")}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})};this._autoselect=function(e,o){if(t.selidx==o)return!0;if(!e.selected||0==e.selected)return!1;var i={id:t.rid,data:e,idx:o};return t.selidx=o,t.onlistselect&&t.onlistselect(i),this.root.observable.trigger("listselect",i),!0}.bind(this),this._select=function(e){-1!=t.selidx&&t.selidx<t.items.length&&(t.items[t.selidx].selected=!1),e.item.item.selected=!0,t.update()}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item.item,idx:e.item.i},t.onlistdbclick&&t.onlistdbclick(data),t.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-grid-view",'<afx-grid-row ref="gridhead" rootid="{rid}" observable="{root.observable}" header="true" class="{grid_row_header:header}" if="{header}" cols="{header}"> </afx-grid-row> <div ref="scroller" style="width:100%; overflow:auto;"> <div ref="container" style="padding-bottom:10px"> <afx-grid-row each="{child, i in rows}" class="{selected: child.selected}" rootid="{parent.rid}" observable="{parent.root.observable}" index="{i}" cols="{child}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}" head="{parent.refs.gridhead}"></afx-grid-row> </div> </div>',"","",function(e){this.header=e.header,this.rows=e.rows||[];var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.selidx=-1,t.nrow=0,t.ongridselect=e.ongridselect,t.ongriddbclick=e.ongriddbclick,t.root.observable=e.observable,t.root.set=function(e,o){if("selected"==e)t._select({item:t.rows[o],preventDefault:function(){}});else if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;t.update()},this.calibrate_size=function(){t.header&&t.refs.gridhead?$(t.refs.scroller).css("height",$(t.root).height()-$(t.refs.gridhead.root).children().first().height()+"px"):$(t.refs.scroller).css("height",$(t.root).height()+"px")},t.root.get=function(e){return"selected"==e?-1==t.selidx?null:t.rows[t.selidx]:t[e]},this.on("mount",function(){t.refs.gridhead&&(t.refs.gridhead.observable=t.root.observable),$(t.refs.container).css("display","table").css("width","100%"),t.calibrate_size(),t.root.observable.on("resize",function(){t.root&&t.calibrate_size()})}),this.on("updated",function(){t.selidx>=t.rows.length&&(t.selidx=-1),t.nrow!=t.rows.length&&(t.nrow=t.rows.length,t.calibrate_size())}),this._select=function(e){var o={id:t.rid,data:e.item};t.ongridselect&&t.ongridselect(o),-1!=t.selidx&&(t.rows[t.selidx].selected=!1),t.selidx=e.item.i,t.rows[t.selidx].selected=!0,t.root.observable.trigger("gridselect",o),e.preventUpdate=!0,t.update()}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item},t.ongriddbclick&&t.ongriddbclick(data),t.root.observable.trigger("griddbclick",data)}.bind(this)}),riot.tag2("afx-grid-row",'<div riot-style="{!header? ⁗display: table-cell;⁗ :⁗⁗}" onclick="{parent._cell_select}" each="{child,i in cols}" class="{string:typeof child.value == ⁗string⁗, number: typeof child.value == ⁗number⁗, cellselected: parent._auto_cell_select(child,i)}"> <afx-label color="{child.color}" icon="{child.icon}" iconclass="{child.iconclass}" text="{child.value}"></afx-label> </div>',"","",function(opts){this.cols=opts.cols||[];var self=this;this.rid=opts.rootid,this.index=opts.index,this.header=eval(opts.header)||!1,this.head=opts.head,this.selidx=-1,self.observable=opts.observable,this.colssize=[];var update_header_size=function(){if(self.cols&&0!=self.cols.length){var e=$(self.root).parent().width();if(0!=e){var t=0,o=0;if(self.colssize=[],$.each(self.cols,function(e,i){i.width?(self.colssize.push(i.width),t+=i.width):(self.colssize.push(-1),o++)}),o>0){var i=parseInt((e-t)/o);$.each(self.colssize,function(e,t){-1==t&&(self.colssize[e]=i)})}calibrate_size()}}},calibrate_size=function(){var e=0;$(self.root).children().each(function(){$(this).css("width",self.colssize[e]+"px"),e++})};this.on("updated",function(){self.header?update_header_size():self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())}),this.on("mount",function(){self.header?($(self.root).css("display","flex").css("flex-direction","row"),update_header_size()):($(self.root).css("display","table-row").css("width","100%"),self.head&&0==self.index&&(self.colssize=self.head.colssize,calibrate_size())),self.observable.on("gridcellselect",function(e){e.id==self.rid&&-1!=self.selidx&&e.row!=self.index&&(self.cols[self.selidx].selected=!1,self.selidx=-1)}),self.observable.on("resize",function(){self.update()})}),this._cell_select=function(e){self.header||(-1!=self.selidx&&(self.cols[self.selidx].selected=!1,self.selidx=-1),self.cols[e.item.i].selected=!0)}.bind(this),this._auto_cell_select=function(e,t){if(!e.selected||self.header)return!1;if(self.selidx==t)return!0;var o={id:self.rid,data:e,col:t,row:self.index};return self.selidx=t,self.observable.trigger("gridcellselect",o),!0}.bind(this)}),riot.tag2("afx-hbox",'<div ref="container" class="afx-hbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){t.root.observable=t.parent&&t.parent.root&&t.parent.root.observable||e.observable||riot.observable(),$(t.refs.container).css("display","flex").css("flex-direction","row").css("width","100%"),o(),t.root.observable&&(t.root.observable.on("resize",function(e,t){o()}),t.root.observable.on("calibrate",function(){o()}))}),t.root.update=function(){t.update()};var o=function(){var e,o,i=[],s=0;o=$(t.root).height(),avaiWidth=$(t.root).width(),$(t.refs.container).css("height",o+"px"),$(t.refs.container).children().each(function(e){this.observable=t.root.observable;var o=$(this).attr("data-width");if(o){if("grow"==o)return;"%"===o[o.length-1]&&(o=Number(o.slice(0,-1))*avaiWidth/100),$(this).css("width",o+"px"),s+=Number(o)}else $(this).css("flex-grow","1"),i.push(this)}),(e=(avaiWidth-s)/i.length)>0&&$.each(i,function(t,o){$(o).css("width",e+"px")}),t.root.observable.trigger("hboxchange",{id:t.rid,w:e,h:o})}}),riot.tag2("afx-html","","",'ref="container"',function(e){this.content=e.content,this.root.innerHTML=this.content,this.updateContent=void 0;var t=this;this.root.set=function(e,o){t[e]=o,"content"==e?t.root.innerHTML=o:"updateContent"==e&&t.update()},this.on("update",function(){t.updateContent&&(t.root.innerHTML=t.updateContent())})}),riot.tag2("afx-label",'<span riot-style="{color?⁗color:⁗ + color:⁗⁗}"> <i if="{iconclass}" class="{iconclass}"></i> <i if="{icon}" class="icon-style" riot-style="{⁗background: url(⁗+window.OS.API.handler.get+⁗/⁗+icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> {text?text.__():⁗⁗} </span>',"","",function(e){this.iconclass=e.iconclass,this.icon=e.icon,this.text=e.text,this.color=e.color;var t=this;this.on("update",function(){t.iconclass=e.iconclass,t.icon=e.icon,t.text=e.text,t.color=e.color}),t.root.set=function(o,i){if("*"==o)for(var s in i)e[s]=i[s];else e[o]=i;t.update()},t.root.get=function(e){return t[e]}}),riot.tag2("afx-list-view",'<div class="list-container" ref="container" style="flex:1;"> <div if="{opts.dropdown == ⁗true⁗}" ref="current" riot-style="{opts.width?⁗min-width:⁗ + opts.width + ⁗px;⁗:⁗⁗}" onclick="{show_list}"></div> <ul ref="mlist"> <li each="{item,i in items}" class="{selected: parent._autoselect(item,i)}" ondblclick="{parent._dbclick}" onclick="{parent._select}" oncontextmenu="{parent._select}"> <afx-label class="{item.class}" color="{item.color}" iconclass="{item.iconclass}" icon="{item.icon}" text="{item.text}"></afx-label> <i if="{item.closable}" class="closable" click="{parent._remove}"></i> <ul if="{item.complex}" class="complex-content"> <li each="{ctn,j in item.detail}" class="{ctn.class}">{ctn.text}</li> </ul> </li> </ul> </div> <div if="{opts.dropdown != ⁗true⁗ && buttons}" class="button_container"> <afx-button each="{btn,i in buttons}" text="{btn.text}" icon="{btn.icon}" iconclass="{btn.iconclass}" onbtclick="{btn.onbtclick}"></afx-button> </div>',"",'class="{dropdown: opts.dropdown == ⁗true⁗}" style="display:flex; flex-direction:column"',function(e){this.items=e.items||[];var t=this;t.selidx=-1,t.onlistselect=e.onlistselect,t.onlistdbclick=e.onlistdbclick,t.onitemclose=e.onitemclose,t.buttons=e.buttons;var o=!1;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.root.set=function(e,o){if("selected"==e)-1!=t.selidx&&(t.items[t.selidx].selected=!1),-1==o?t.selidx=-1:t.items[o]&&(t.items[o].selected=!0);else if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;t.update()},t.root.get=function(e){return"selected"==e?-1!=t.selidx?t.items[t.selidx]:void 0:"count"==e?t.items.length:t[e]},t.root.selectNext=function(){var e=t.selidx+1;e>=t.items.length||(-1!=t.selidx&&(t.items[t.selidx].selected=!1),t.items[e].selected=!0,t.update())},t.root.selectPrev=function(){var e=t.selidx-1;e<0||(-1!=t.selidx&&(t.items[t.selidx].selected=!1),t.items[e].selected=!0,t.update())},t.root.push=function(e,o){t.items.push(e),o&&t.update()},t.root.unshift=function(e,o){t.items.unshift(e),o&&t.update()},t.root.replaceItem=function(e,o,i){var s=t.items.indexOf(e);s>=0&&(t.items[s]=o,i&&t.update())},t.root.remove=function(e,i){var s=t.items.indexOf(e);s>=0&&(-1!=t.selidx&&(t.items[t.selidx].selected=!1,t.selidx=-1),t.items.splice(s,1),i&&t.update(),o=!0)},e.observable?this.root.observable=e.observable:this.root.observable=riot.observable(),this.on("mount",function(){t.root.observable=e.observable||t.parent&&t.parent.root&&t.parent.root.observable||riot.observable(),"true"==e.dropdown&&(t.root.observable.on("calibrate",function(){$(t.refs.container).css("width",$(t.root).width()+"px"),$(t.refs.mlist).css("width",$(t.root).width()+"px")}),$(document).click(function(e){$(e.target).closest(t.refs.container).length||$(t.refs.mlist).hide()}),$(t.refs.container).css("position","absolute").css("display","inline-block"),$(t.refs.mlist).css("position","absolute").css("display","none").css("top","100%").css("left","0"),t.root.observable.on("vboxchange",function(e){e.id==t.parent.rid&&$(t.refs.container).css("width",$(t.root).parent().innerWidth()+"px")}))}),this.show_list=function(e){var o=$("#desktop").height();$(t.root).offset().top+$(t.refs.mlist).height()>o?$(t.refs.mlist).css("top","-"+$(t.refs.mlist).outerHeight()+"px"):$(t.refs.mlist).css("top","100%"),$(t.refs.mlist).show(),e.preventUpdate=!0}.bind(this),this._remove=function(e){r=!0,t.onitemclose&&(r=t.onitemclose(e)),r&&t.root.remove(e.item.item,!0)}.bind(this),this._autoselect=function(o,i){if(!o.selected||0==o.selected)return!1;if(t.selidx==i)return!0;var s={id:t.rid,data:o,idx:i};return t.selidx=i,"true"==e.dropdown&&($(t.refs.mlist).hide(),$(t.refs.current).html(o.text)),t.onlistselect&&t.onlistselect(s),this.root.observable.trigger("listselect",s),!0}.bind(this),this._select=function(e){if(o)return o=!1,void(e.preventUpdate=!0);-1!=t.selidx&&t.selidx<t.items.length&&(t.items[t.selidx].selected=!1),e.item.item.selected=!0}.bind(this),this._dbclick=function(e){data={id:t.rid,data:e.item.item,idx:e.item.i},t.onlistdbclick&&t.onlistdbclick(data),t.root.observable.trigger("listdbclick",data)}.bind(this)}),riot.tag2("afx-menu",'<ul class="{context: opts.context == ⁗true⁗}"> <li class="afx-corner-fix"></li> <li ref="container" each="{data,i in items}" class="{afx_submenu:data.child != null && data.child.length > 0, fix_padding:data.icon}" no-reorder> <a href="#" onclick="{parent.onselect}"> <afx-switch if="{data.switch || data.radio}" class="{checked:parent.checkItem(data)}" enable="false" swon="{data.checked}"></afx-switch> <afx-label color="{data.color}" iconclass="{data.iconclass}" icon="{data.icon}" text="{data.text}"></afx-label> <span if="{data.shortcut}" class="shortcut">{data.shortcut}</span> </a> <afx-menu ref="submenus" index="{i}" if="{data.child != null && data.child.length > 0}" child="{data.child}" onmenuselect="{data.onmenuselect}" observable="{parent.root.observable}" rootid="{parent.rid}"></afx-menu> </li> <li class="afx-corner-fix"></li> </ul>',"","",function(e){var t;this.items=e.child||[],null!=e.index?this.index=e.index:this.index=-1;var o=void 0;e.rootid?(this.rid=e.rootid,t=!1):(this.rid=$(this.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t=!0);var i=this;this.onmenuselect=e.onmenuselect,this.checkItem=function(e){return 1==e.checked&&e.radio&&(o&&(o.checked=!1),(o=e).checked=!0),!1}.bind(this),i.root.set=function(e,t){if("*"==e)for(var o in t)i[o]=t[o];else i[e]=t;i.update()},i.root.push=function(e,t){i.items.push(e),t&&i.update()},i.root.unshift=function(e,t){i.items.unshift(e),t&&i.update()},i.root.remove=function(e,t){var o=i.items.indexOf(e);o>=0&&i.items.splice(o,1),t&&i.update()},i.root.update=function(){i.update()},i.root.get=function(e){return i[e]},i.root.show=function(t){"true"==e.context&&($(i.root).css("top",t.clientY-15+"px").css("left",t.clientX-5+"px").show(),$(document).on("click",s))},e.observable?this.root.observable=e.observable:(this.root.observable=riot.observable(),this.root.observable.on("menuselect",function(t){if(i.onmenuselect&&i.onmenuselect(t),"true"==e.context)$(i.root).hide();else if(!t.root&&i.refs.container){var o=i.refs.container.length?i.refs.container:[i.refs.container];for(var s in o)$("afx-menu",o[s]).first().hide()}}));var s=function(t){if("true"!=e.context){if(!$(t.target).closest(i.refs.container).length&&i.refs.container){var o=i.refs.container.length?i.refs.container:[i.refs.container];for(var r in o)$("afx-menu",o[r]).first().hide();$(document).unbind("click",s)}else if(i.refs.container&&i.refs.container.length)for(var r in i.refs.container)$(t.target).closest(i.refs.container[r]).length||$("afx-menu",i.refs.container[r]).first().hide()}else $(t.target).closest(i.root).length||($(i.root).hide(),$(document).unbind("click",s))};this.onselect=function(r){var n={id:i.rid,root:t,e:r,item:r.item};if(r.item.data.switch?r.item.data.checked=!r.item.data.checked:r.item.data.radio&&(o&&(o.checked=!1),r.item.data.checked=!0,o=r.item.data),this.root.observable.trigger("menuselect",n),this.onmenuselect&&!t&&this.onmenuselect(n),r.preventDefault(),$(document).unbind("click",s),"true"!=e.context)return t&&i.refs.container?(i.refs.container.length?$("afx-menu",i.refs.container[r.item.i]).first().show():$("afx-menu",i.refs.container).first().show(),void $(document).on("click",s)):void 0}.bind(this)}),riot.tag2("afx-overlay","<yield></yield>","","",function(e){this.width=e.width||200,this.height=e.height||400;var t=this;t.commander=null,this.root.observable=e.observable||riot.observable();var o=$(t.root).attr("data-id"),i=function(){$(t.root).css("width",t.width+"px").css("height",t.height+"px"),t.root.observable.trigger("resize",{id:o,w:t.width,h:t.height})};t.root.set=function(e,o){if("*"==e)for(var s in o)t[s]=o[s];else t[e]=o;"width"!=e&&"height"!=e||i(),t.update()},t.root.get=function(e){return t[e]},t.on("mount",function(){$(t.root).css("position","absolute"),$(t.root).children().each(function(e){this.observalbe=t.root.observalbe}),i(),t.root.observable.trigger("rendered",t.root)})}),riot.tag2("afx-resizer","","","",function(e){var t=this;t.dir="hz",t.resizable=void 0,t.parent=void 0,t.minsize=0,t.on("mount",function(){var e=$(t.parent.root).prop("tagName");t.resizable=1==$(t.root).prev().length?$(t.root).prev()[0]:void 0,"AFX-HBOX"==e?(t.dir="hz",$(t.root).css("cursor","col-resize"),t.resizable&&(t.minsize=parseInt($(t.resizable).attr("min-width")))):"AFX-VBOX"==e?(t.dir="ve",$(t.root).css("cursor","row-resize"),t.resizable&&(t.minsize=parseInt($(t.resizable).attr("min-height")))):t.dir="none",o()});var o=function(){$(t.root).css("user-select","none"),$(t.root).on("mousedown",function(e){e.preventDefault(),$(window).on("mousemove",function(e){t.resizable&&("hz"==t.dir?i(e):"ve"==t.dir&&s(e))}),$(window).on("mouseup",function(e){$(window).unbind("mousemove",null)})})},i=function(e){if(t.resizable){var o=$(t.resizable).offset();w=Math.round(e.clientX-o.left),w<t.minsize&&(w=t.minsize),$(t.resizable).attr("data-width",w.toString()),t.parent.root.observable.trigger("calibrate",t.resizable)}},s=function(e){if(t.resizable){var o=$(t.resizable).offset();h=Math.round(e.clientY-o.top),h<t.minsize&&(h=minsize),$(t.resizable).attr("data-height",h.toString()),t.parent.root.observable.trigger("calibrate",t.resizable)}}}),riot.tag2("afx-switch",'<span class="{swon: swon}" onclick="{toggle}"></span>',"","",function(e){null!=e.swon?this.swon=e.swon:this.swon=!1;var t=this;null!=e.enable?this.enable=e.enable:this.enable=!0,this.onchange=e.onchange,this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.root.set=function(o,i){if("*"==o)for(var s in i)e[s]=i[s];else e[o]=i;t.update()},t.root.get=function(e){return t[e]},this.root.toggle=function(){e.swon=!t.swon,t.update()},this.on("update",function(o){t.swon="function"==typeof e.swon?e.swon():e.swon}),this.toggle=function(o){if(t.enable){e.swon=!t.swon;var i={id:t.rid,data:e.swon};t.onchange&&t.onchange(i),t.root.observable&&t.root.observable.trigger("switch",i)}}.bind(this)}),riot.tag2("afx-sys-panel",'<div> <afx-menu data-id="os_menu" ref="aOsmenu" child="{osmenu.child}" onmenuselect="{osmenu.onmenuselect}" class="afx-panel-os-menu"></afx-menu> <afx-menu data-id="appmenu" ref="aAppmenu" child="{appmenu.child}" class="afx-panel-os-app"></afx-menu> <afx-menu data-id="sys_tray" ref="aTray" child="{systray.child}" onmenuselect="{systray.onmenuselect}" class="afx-panel-os-stray"></afx-menu> </div>',"","",function(e){this.osmenu={child:[]},this.appmenu={child:[]},this.systray={child:[],onmenuselect:function(e){e.root&&e.e.item.data.awake(e.e)}};var t=this;t.root.attachservice=function(e){t.refs.aTray.root.unshift(e,!0),e.attach(t.refs.aTray)},t.root.detachservice=function(e){t.refs.aTray.root.remove(e,!0)},t.root.set=function(e,o){if("*"==e)for(var i in o)t[i]=o[i];else t[e]=o;t.update()},t.root.get=function(e){return t[e]},t.root.update=function(){t.update()},this.on("mount",function(){$(t.refs.aOsmenu.root).css("z-index",1e6),$(t.refs.aAppmenu.root).css("z-index",1e6),$(t.refs.aTray.root).css("z-index",1e6),window.OS.courrier.trigger("syspanelloaded")})}),riot.tag2("afx-tab-bar",'<afx-list-view ref="list"></afx-list-view>',"","",function(e){var t=this;this.closable=e.closable||!1,t.ontabselect=e.ontabselect,this.get_observable=function(){return t.root.observable}.bind(this),t.root.get=function(e){return t.refs.list.root.get(e)},t.root.update=function(){t.update(!0)},t.on("mount",function(){t.root.observable=e.observable||t.parent&&t.parent.root&&t.parent.root.observable||riot.observable(),t.refs.list.root.observable=t.root.observable,t.refs.list.root.set("onlistselect",function(e){t.root.observable.trigger("tabselect",e),t.ontabselect&&t.ontabselect(e)})}),t.root.set=function(e,o){if("*"==e)for(var i in o)t.refs.list.root.set(i,o[i]);else if("closable"==e)t.closable=o;else if("ontabselect"==e)t.ontabselect=o;else{if("items"==e)for(var i in o)o[i].closable=t.closable;t.refs.list.root.set(e,o)}},t.root.push=function(e,o){e.closable=t.closable,t.refs.list.root.push(e,o)},t.root.replaceItem=function(e,o,i){o.closable=t.closable,t.refs.list.root.replaceItem(e,o,i)},t.root.unshift=function(e,o){t.refs.list.root.unshift(e,o)},t.root.remove=function(e,o){t.refs.list.root.remove(e,o)}}),riot.tag2("afx-tab-container",'<afx-hbox ref="mybox" if="{bar == ⁗left⁗}"> <afx-tab-bar data-ref="tabbar"></afx-tab-bar> <div data-ref="container"></div> </afx-hbox> <afx-vbox ref="mybox" if="{bar == ⁗top⁗}"> <afx-tab-bar data-ref="tabbar"></afx-tab-bar> <div data-ref="container"></div> </afx-vbox>',"","",function(e){this.bar=e.bar||"top",this.barwidth=e.barwidth,this.barheight=e.barheight;var t=this,o=function(){$(t.refs.mybox.root).css("width",$(t.root).width()+"px"),$(t.refs.mybox.root).css("height",$(t.root).height()+"px"),t.root.observable.trigger("calibrate")};t.on("mount",function(){t.tabbar=$("[data-ref='tabbar']",t.root)[0],t.container=$("[data-ref='container']",t.root)[0],t.barwidth&&$(t.tabbar).attr("data-width",t.barwidth),t.barheight&&$(t.tabbar).attr("data-height",t.barheight),t.root.observable=t.parent&&t.parent.root&&t.parent.root.observable||e.observable||riot.observable(),t.tabbar.set("ontabselect",function(e){$(t.container).children().each(function(e){$(this).hide()}),$(e.data.scheme).show(),e.data.handler.render(),o()}),t.root.observable.on("resize",function(){o()})}),t.on("update",function(){$(t.container).children().each(function(e){this.update&&this.update()})});var i=function(e){var o=$.parseHTML(e.scheme);$(t.container).append(o),e.scheme=o,riot.mount(o,{observable:t.root.observable}),$(o).hide(),e.handler=e.handler(o[0]),t.root.observable.trigger("tabrendered")};t.root.setTabs=function(e){var o;e.length<=0?t.tabbar.set("selected",0):(t.root.observable.one("tabrendered",function(){e.splice(0,1),t.root.setTabs(e)}),(o=e[0]).f||(o.f=function(){}),t.tabbar.push(o),o.url?o.url.asFileHandler().read(function(e){o.scheme=e,i(o)}):i(o))}}),riot.tag2("afx-tree-view",'<div class="{afx_tree_item_selected:treeroot.selectedItem && treeroot.selectedItem.treepath == data.treepath, afx_folder_item: isFolder(), afx_tree_item_odd: index%2 != 0}" onclick="{select}" ondblclick="{_dbclick}" oncontextmenu="{select}"> <ul style="padding:0;margin:0;white-space: nowrap;"> <li ref="padding"></li> <li class="itemname" style="display:inline-block;"> <i if="{!isFolder() && data.iconclass}" class="{data.iconclass}"></i> <i if="{!isFolder() && data.icon}" class="icon-style" riot-style="{⁗background: url(⁗+data.icon+⁗);background-size: 100% 100%;background-repeat: no-repeat;⁗}"></i> <span onclick="{toggle}" if="{isFolder()}" class="{open ? \'afx-tree-view-folder-open\' : \'afx-tree-view-folder-close\'}"></span> {data.name} </li> </ul> </div> <ul if="{isFolder()}" show="{isFolder() && open}"> <li each="{child, i in data.nodes}"> <afx-tree-view ontreeselect="{parent.ontreeselect}" index="{i}" fetch="{parent.fetch}" ontreedbclick="{parent.ontreedbclick}" data="{child}" indent="{indent+1}" observable="{parent.root.observable}" path="{parent.data.treepath + ⁗>⁗ + i}" treeroot="{parent.treeroot}"></afx-tree-view> </li> </ul>',"","",function(e){var t=this;t.open=!0,t.data={name:"",nodes:null,treepath:e.path,i:-1},e.data&&(t.data=e.data,t.open=null==e.data.open||e.data.open),t.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,t.data.rid=t.rid,t.data.i=e.index,t.ontreeselect=e.ontreeselect,t.ontreedbclick=e.ontreedbclick,t.fetch=e.fetch,t.indent=e.indent||0;var o=!1;e.treeroot?(this.treeroot=e.treeroot,this.treeroot.counter++):(this.treeroot=t,this.treeroot.counter=0),t.data.treepath=e.path||0,t.selectedItem=null,t.index=this.treeroot.counter;var i=function(e,t,o,s){if(t[o]==s)return e.push(t);if(t.nodes&&t.nodes.length>0)for(var r in t.nodes)i(e,t.nodes[r],o,s)};t.root.find=function(e,o){var s=[];return i(s,t.data,e,o),s},t.root.set=function(e,o){if("*"==e)for(var i in o)t[i]=o[i];else if("data"==e)for(var i in o)t.data[i]=o[i];else"selectedItem"==e?(t.ontreeselect&&t.ontreeselect(t.data),t.treeroot.selectedItem=o,t.root.observable.trigger("treeselect",t.data)):t[e]=o;t.update()},t.root.get=function(e){return t[e]},e.observable?this.root.observable=e.observable:this.root.observable=riot.observable(),this.on("mount",function(){$(t.refs.padding).css("display","inline-block").css("height","1px").css("padding",0).css("margin",0).css("background-color","transparent").css("width",15*t.indent+"px")}),this.isFolder=function(){return t.data.nodes}.bind(this),this.toggle=function(e){t.open=!t.open,e.preventDefault(),o=!0,t.open&&0==t.data.nodes.length&&t.fetch&&t.fetch(e.item,function(e){t.data.nodes=e,t.update()})}.bind(this),this.select=function(e){o?o=!1:(t.ontreeselect&&t.ontreeselect(t.data),t.treeroot.selectedItem=t.data,this.root.observable.trigger("treeselect",t.data),e.preventUpdate=!0,t.treeroot.update(),e.preventDefault())}.bind(this),this._dbclick=function(e){o?o=!1:(t.ontreedbclick&&t.ontreedbclick(t.data),t.root.observable.trigger("treedbclick",t.data))}.bind(this)}),riot.tag2("afx-vbox",'<div ref="container" class="afx-vbox-container"> <yield></yield> </div>',"",'style="display:block;"',function(e){var t=this;this.rid=$(t.root).attr("data-id")||Math.floor(1e5*Math.random())+1,this.on("mount",function(){t.root.observable=t.parent&&t.parent.root&&t.parent.root.observable||e.observable||riot.observable(),$(t.refs.container).css("display","flex").css("flex-direction","column").css("width","100%"),o(),t.root.observable&&(t.root.observable.on("resize",function(e,t){o()}),t.root.observable.on("calibrate",function(){o()}))}),t.root.update=function(){t.update()};var o=function(){var e,o,i=[],s=0;o=$(t.root).height(),avaiwidth=$(t.root).width(),$(t.refs.container).css("height",o+"px"),$(t.refs.container).children().each(function(e){this.observable=t.root.observable;var r=$(this).attr("data-height");if(r){if("grow"==r)return;"%"===r[r.length-1]&&(r=Number(r.slice(0,-1))*o/100),$(this).css("height",r+"px"),s+=Number(r)}else $(this).css("flex-grow","1"),i.push(this)}),(e=(o-s)/i.length)>0&&$.each(i,function(t,o){$(o).css("height",e+"px")}),t.root.observable.trigger("vboxchange",{id:t.rid,w:avaiwidth,h:e})}});