(function(){var e,n={}.hasOwnProperty;(e=function(e){function t(e){t.__super__.constructor.call(this,"NotePad",e)}return function(e,t){for(var i in t)n.call(t,i)&&(e[i]=t[i]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.main=function(){var e,t,n,i,r,a,s,o,c,l,u,h,d,f,p;for((c=this).scheme.set("apptitle","NotePad"),this.sidebar=this.find("sidebar"),this.location=this.find("location"),this.fileview=this.find("fileview"),e=this.find("datarea"),ace.require("ace/ext/language_tools"),this.currfile=this.args&&0<this.args.length?this.args[0].asFileHandler():"Untitled".asFileHandler(),this.editor=ace.edit(e),this.editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,fontSize:"9pt"}),this.editor.completers.push({getCompletions:function(e,t,i,r,n){}}),this.editor.getSession().setUseWrapMode(!0),this.fileview.contextmenuHandler=function(e,t){return t.set("items",c.contextMenu()),t.set("onmenuselect",function(e){return c.contextAction(e)}),t.show(e)},this.mlist=this.find("modelist"),this.modes=ace.require("ace/ext/modelist"),a=[],t=function(e,t){return a.push({text:e.name,mode:e.mode,selected:"ace/mode/text"===e.mode}),e.idx=t},l=this.modes.modes,n=i=0,s=l.length;i<s;n=++i)t(o=l[n],n);for(r in this.mlist.set("items",a),this.mlist.set("onlistselect",function(e){return c.editor.session.setMode(e.data.mode)}),f=this.find("themelist"),p=ace.require("ace/ext/themelist"),a=[],u=p.themesByName)o=u[r],a.push({text:o.caption,mode:o.theme,selected:"ace/theme/monokai"===o.theme});return f.set("onlistselect",function(e){return c.editor.setTheme(e.data.mode)}),f.set("items",a),h=this.find("editorstat"),(d=function(e){var t,i;return t=c.editor.session.selection.getCursor(),i=c.editor.session.getLength(),h.set("text",__("Row {0}, col {1}, lines: {2}",t.row,t.column,i))})(),this.editor.getSession().selection.on("changeCursor",function(e){return d()}),this.editormux=!1,this.editor.on("input",function(){return c.editormux?c.editormux=!1:c.currfile.dirty?void 0:(c.currfile.dirty=!0,c.currfile.text+="*",c.tabarea.update())}),this.on("resize",function(){return c.editor.resize()}),this.on("focus",function(){return c.editor.focus()}),this.fileview.set("chdir",function(e){return c.chdir(e)}),this.fileview.set("fetch",function(t,i){if(t.child&&"[..]"!==t.child.filename)return t.child.path.asFileHandler().read(function(e){return e.error?c.error(__("Resource not found {0}",t.child.path)):i(e.result)})}),this.fileview.set("onfileopen",function(e){if("dir"!==e.type)return c.open(e.path.asFileHandler())}),this.subscribe("VFS",function(e){var t;if(t=c.fileview.get("path").asFileHandler(),e.data.file.hash()===t.hash()||e.data.file.parent().hash()===t.hash())return c.chdir(t.path)}),this.location.set("onlistselect",function(e){return c.chdir(e.data.path)}),this.location.set("items",function(){var e,t,i,r;for(r=[],t=0,e=(i=this.systemsetting.VFS.mountpoints).length;t<e;t++)"app"!==(n=i[t]).type&&r.push(n);return r}.call(this)),this.location.get("selected")||this.location.set("selected",0),this.tabarea=this.find("tabarea"),this.tabarea.set("ontabselect",function(e){return c.selecteTab(e.idx)}),this.tabarea.set("onitemclose",function(e){var t;return!!(t=e.item.item)&&(t.dirty?(c.openDialog("YesNoDialog",function(e){return e?c.closeTab(t):c.editor.focus()},__("Close tab"),{text:__("Close without saving ?")}),!1):c.closeTab(t))}),this.bindKey("ALT-N",function(){return c.actionFile(c.name+"-New")}),this.bindKey("ALT-O",function(){return c.actionFile(c.name+"-Open")}),this.bindKey("CTRL-S",function(){return c.actionFile(c.name+"-Save")}),this.bindKey("ALT-W",function(){return c.actionFile(c.name+"-Saveas")}),this.open(this.currfile)},t.prototype.open=function(t){var e,i;return-1!==(e=this.findTabByFile(t))?this.tabarea.set("selected",e):"Untitled"===t.path.toString()?this.newtab(t):(i=this,t.read(function(e){return t.cache=e||"",i.newtab(t)}))},t.prototype.contextMenu=function(){return[{text:__("New file"),dataid:this.name+"-mkf"},{text:__("New folder"),dataid:this.name+"-mkd"},{text:__("Delete"),dataid:this.name+"-rm"},{text:__("Refresh"),dataid:this.name+"-refresh"}]},t.prototype.contextAction=function(e){var i,t,r;switch(t=(r=this).fileview.get("selectedFile"),i=t?t.path.asFileHandler():this.fileview.get("path").asFileHandler(),console.log(i),t&&"dir"!==t.type&&(i=i.parent().asFileHandler()),e.item.data.dataid){case this.name+"-mkd":return this.openDialog("PromptDialog",function(t){return i.mk(t,function(e){if(e.error)return r.error(__("Fail to create {0}: {1}",t,e.error))})},"__(New folder)");case this.name+"-mkf":return this.openDialog("PromptDialog",function(t){return(i.path+"/"+t).asFileHandler().write("",function(e){if(e.error)return r.error(__("Fail to create {0}: {1}",t,e.error))})},"__(New file)");case this.name+"-rm":if(!t)return;return this.openDialog("YesNoDialog",function(e){if(e)return t.path.asFileHandler().remove(function(e){if(e.error)return r.error(__("Fail to delete {0}: {1}",t.filename,e.error))})},"__(Delete)",{iconclass:"fa fa-question-circle",text:__("Do you really want to delete: {0}?",t.filename)});case this.name+"-refresh":return this.chdir(this.fileview.get("path"))}},t.prototype.save=function(t){var i;return i=this,t.write("text/plain",function(e){return e.error?i.error(__("Error saving file {0}",t.basename)):(t.dirty=!1,t.text=t.basename,i.tabarea.update())})},t.prototype.findTabByFile=function(r){var n,e,a;return a=this.tabarea.get("items"),0===(e=function(){var e,t,i;for(i=[],n=e=0,t=a.length;e<t;n=++e)a[n].hash()===r.hash()&&i.push(n);return i}()).length?-1:e[0]},t.prototype.closeTab=function(e){var t;return this.tabarea.remove(e,!1),0===(t=this.tabarea.get("count"))?this.open("Untitled".asFileHandler()):this.tabarea.set("selected",t-1),!1},t.prototype.newtab=function(e){return e.text=e.basename?e.basename:e.path,e.cache||(e.cache=""),e.um=new ace.UndoManager,this.currfile.selected=!1,e.selected=!0,this.tabarea.push(e,!0)},t.prototype.selecteTab=function(e){var t,i;if(t=this.tabarea.get("items")[e])return this.fileview.set("preventUpdate",!0),this.scheme.set("apptitle",t.text.toString()),this.currfile!==t&&(this.currfile.cache=this.editor.getValue(),this.currfile.cursor=this.editor.selection.getCursor(),this.currfile=t),i="ace/mode/text","Untitled"!==t.path.toString()&&(i=this.modes.getModeForPath(t.path)),this.mlist.set("selected",i.idx),this.editormux=!0,this.editor.setValue(t.cache,-1),this.editor.session.setMode(i.mode),this.editor.session.setUndoManager(t.um),t.cursor&&(this.editor.renderer.scrollCursorIntoView({row:t.cursor.row,column:t.cursor.column},.5),this.editor.selection.moveTo(t.cursor.row,t.cursor.column)),this.editor.focus()},t.prototype.chdir=function(i){var r,n;if(i)return n=this,(r=i.asFileHandler()).read(function(e){var t;return e.error?n.error(__("Resource not found {0}",t)):(r.isRoot()||((t=r.parent().asFileHandler()).filename="[..]",t.type="dir",e.result.unshift(t)),$(n.navinput).val(r.path),n.fileview.set("path",i),n.fileview.set("data",e.result))})},t.prototype.menu=function(){var t;return[{text:"__(File)",child:[{text:"__(New)",dataid:(t=this).name+"-New",shortcut:"A-N"},{text:"__(Open)",dataid:this.name+"-Open",shortcut:"A-O"},{text:"__(Save)",dataid:this.name+"-Save",shortcut:"C-S"},{text:"__(Save as)",dataid:this.name+"-Saveas",shortcut:"A-W"}],onmenuselect:function(e){return t.actionFile(e.item.data.dataid)}}]},t.prototype.actionFile=function(e){var r,t;switch(r=this,t=function(){return r.openDialog("FileDiaLog",function(e,t){var i;return(i=(e+"/"+t).asFileHandler()).cache=r.currfile.cache,i.dirty=r.currfile.dirty,i.um=r.currfile.um,i.cursor=r.currfile.cursor,i.selected=r.currfile.selected,i.text=r.currfile.text,r.tabarea.replaceItem(r.currfile,i,!1),r.currfile=i,r.save(r.currfile)},"__(Save as)",{file:r.currfile})},e){case this.name+"-Open":return this.openDialog("FileDiaLog",function(e,t){return r.open((e+"/"+t).asFileHandler())},"__(Open file)");case this.name+"-Save":return this.currfile.cache=this.editor.getValue(),this.currfile.basename?this.save(this.currfile):t();case this.name+"-Saveas":return this.currfile.cache=this.editor.getValue(),t();case this.name+"-New":return this.open("Untitled".asFileHandler())}},t.prototype.cleanup=function(e){var r,n,a;if(0!==(r=function(){var e,t,i,r;for(r=[],e=0,t=(i=this.tabarea.get("items")).length;e<t;e++)(a=i[e]).dirty&&r.push(a);return r}.call(this)).length)return n=this,e.preventDefault(),this.openDialog("YesNoDialog",function(e){var t,i;if(e){for(t=0,i=r.length;t<i;t++)(a=r[t]).dirty=!1;return n.quit()}},"__(Quit)",{text:__("Ignore all {0} unsaved files ?",r.length)})},t}(this.OS.GUI.BaseApplication)).singleton=!1,e.dependencies=["ace/ace","ace/ext-language_tools","ace/ext-modelist","ace/ext-themelist"],this.OS.register("NotePad",e)}).call(this);