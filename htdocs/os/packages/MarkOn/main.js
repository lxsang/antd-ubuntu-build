(function(){var e,n={}.hasOwnProperty;(e=function(e){function t(e){t.__super__.constructor.call(this,"MarkOn",e)}return function(e,t){for(var i in t)n.call(t,i)&&(e[i]=t[i]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.main=function(){var e,t;return e=(t=this).find("markarea"),this.container=this.find("mycontainer"),this.previewOn=!1,this.currfile=this.args&&0<this.args.length?this.args[0].asFileHandler():"Untitled".asFileHandler(),this.editormux=!1,this.editor=new SimpleMDE({element:e,autofocus:!0,tabSize:4,indentWithTabs:!0,toolbar:["bold","italic","heading","|","quote","code","unordered-list","ordered-list","|","link","image","table","horizontal-rule","|",{name:"preview",className:"fa fa-eye no-disable",action:function(e){return t.previewOn=!t.previewOn,SimpleMDE.togglePreview(e)}}]}),this.editor.codemirror.on("change",function(){if(!t.editormux)return!1===t.currfile.dirty?(t.currfile.dirty=!0,t.scheme.set("apptitle",t.currfile.basename+"*")):void 0}),this.on("hboxchange",function(e){return t.resizeContent()}),this.bindKey("ALT-N",function(){return t.actionFile(t.name+"-New")}),this.bindKey("ALT-O",function(){return t.actionFile(t.name+"-Open")}),this.bindKey("CTRL-S",function(){return t.actionFile(t.name+"-Save")}),this.bindKey("ALT-W",function(){return t.actionFile(t.name+"-Saveas")}),this.resizeContent(),this.open(this.currfile)},t.prototype.resizeContent=function(){var e,t,i,r,n;return t=$(this.container).children(),r=$(this.scheme).find(".afx-window-top")[0],n=t[1],i=t[4],e=$(this.scheme).height()-$(r).height()-$(n).height()-$(i).height()-40,$(t[2]).css("height",e+"px")},t.prototype.open=function(t){var i;if("Untitled"!==t.path)return i=this,t.dirty=!1,t.read(function(e){return i.currfile=t,i.editormux=!0,i.editor.value(e),i.scheme.set("apptitle",""+i.currfile.basename),i.editormux=!1})},t.prototype.save=function(t){var i;return i=this,t.write("text/plain",function(e){return e.error?i.error(__("Error saving file {0}",t.basename)):(t.dirty=!1,t.text=t.basename,i.scheme.set("apptitle",""+i.currfile.basename))})},t.prototype.menu=function(){var t;return[{text:"__(File)",child:[{text:"__(New)",dataid:(t=this).name+"-New",shortcut:"A-N"},{text:"__(Open)",dataid:this.name+"-Open",shortcut:"A-O"},{text:"__(Save)",dataid:this.name+"-Save",shortcut:"C-S"},{text:"__(Save as)",dataid:this.name+"-Saveas",shortcut:"A-W"}],onmenuselect:function(e){return t.actionFile(e.item.data.dataid)}}]},t.prototype.actionFile=function(e){var i,t;switch(i=this,t=function(){return i.openDialog("FileDiaLog",function(e,t){return i.currfile.setPath(e+"/"+t),i.save(i.currfile)},__("Save as"),{file:i.currfile})},e){case this.name+"-Open":return this.openDialog("FileDiaLog",function(e,t){return i.open((e+"/"+t).asFileHandler())},__("Open file"));case this.name+"-Save":return this.currfile.cache=this.editor.value(),this.currfile.basename?this.save(this.currfile):t();case this.name+"-Saveas":return this.currfile.cache=this.editor.value(),t();case this.name+"-New":return this.currfile="Untitled".asFileHandler(),this.currfile.cache="",this.editor.value("")}},t.prototype.cleanup=function(e){var t;if(this.currfile.dirty)return t=this,e.preventDefault(),this.openDialog("YesNoDialog",function(e){if(e)return t.currfile.dirty=!1,t.quit()},__("Quit"),{text:__("Quit without saving ?")})},t}(this.OS.GUI.BaseApplication)).dependencies=["mde/simplemde.min"],this.OS.register("MarkOn",e)}).call(this);