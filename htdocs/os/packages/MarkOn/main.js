(function(){var e,t={}.hasOwnProperty;(e=function(e){function i(e){i.__super__.constructor.call(this,"MarkOn",e)}return function(e,i){for(var r in i)t.call(i,r)&&(e[r]=i[r]);function n(){this.constructor=e}n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype}(i,e),i.prototype.main=function(){var e,t;return t=this,e=this.find("markarea"),this.container=this.find("mycontainer"),this.previewOn=!1,this.currfile=this.args&&this.args.length>0?this.args[0].asFileHandler():"Untitled".asFileHandler(),this.editormux=!1,this.editor=new SimpleMDE({element:e,autofocus:!0,tabSize:4,indentWithTabs:!0,toolbar:["bold","italic","heading","|","quote","code","unordered-list","ordered-list","|","link","image","table","horizontal-rule","|",{name:"preview",className:"fa fa-eye no-disable",action:function(e){return t.previewOn=!t.previewOn,SimpleMDE.togglePreview(e)}}]}),this.editor.codemirror.on("change",function(){if(!t.editormux)return!1===t.currfile.dirty?(t.currfile.dirty=!0,t.scheme.set("apptitle",t.currfile.basename+"*")):void 0}),this.on("hboxchange",function(e){return t.resizeContent()}),this.bindKey("ALT-N",function(){return t.actionFile(t.name+"-New")}),this.bindKey("ALT-O",function(){return t.actionFile(t.name+"-Open")}),this.bindKey("CTRL-S",function(){return t.actionFile(t.name+"-Save")}),this.bindKey("ALT-W",function(){return t.actionFile(t.name+"-Saveas")}),this.resizeContent(),this.open(this.currfile)},i.prototype.resizeContent=function(){var e,t,i,r,n;return t=$(this.container).children(),r=$(this.scheme).find(".afx-window-top")[0],n=t[1],i=t[4],e=$(this.scheme).height()-$(r).height()-$(n).height()-$(i).height()-40,$(t[2]).css("height",e+"px")},i.prototype.open=function(e){var t;if("Untitled"!==e.path)return t=this,e.dirty=!1,e.read(function(i){return t.currfile=e,t.editormux=!0,t.editor.value(i),t.scheme.set("apptitle",""+t.currfile.basename),t.editormux=!1})},i.prototype.save=function(e){var t;return t=this,e.write("text/plain",function(i){return i.error?t.error(__("Error saving file {0}",e.basename)):(e.dirty=!1,e.text=e.basename,t.scheme.set("apptitle",""+t.currfile.basename))})},i.prototype.menu=function(){var e;return e=this,[{text:"__(File)",child:[{text:"__(New)",dataid:this.name+"-New",shortcut:"A-N"},{text:"__(Open)",dataid:this.name+"-Open",shortcut:"A-O"},{text:"__(Save)",dataid:this.name+"-Save",shortcut:"C-S"},{text:"__(Save as)",dataid:this.name+"-Saveas",shortcut:"A-W"}],onmenuselect:function(t){return e.actionFile(t.item.data.dataid)}}]},i.prototype.actionFile=function(e){var t,i;switch(t=this,i=function(){return t.openDialog("FileDiaLog",function(e,i){return t.currfile.setPath(e+"/"+i),t.save(t.currfile)},__("Save as"),{file:t.currfile})},e){case this.name+"-Open":return this.openDialog("FileDiaLog",function(e,i){return t.open((e+"/"+i).asFileHandler())},__("Open file"));case this.name+"-Save":return this.currfile.cache=this.editor.value(),this.currfile.basename?this.save(this.currfile):i();case this.name+"-Saveas":return this.currfile.cache=this.editor.value(),i();case this.name+"-New":return this.currfile="Untitled".asFileHandler(),this.currfile.cache="",this.editor.value("")}},i.prototype.cleanup=function(e){var t;if(this.currfile.dirty)return t=this,e.preventDefault(),this.openDialog("YesNoDialog",function(e){if(e)return t.currfile.dirty=!1,t.quit()},__("Quit"),{text:__("Quit without saving ?")})},i}(this.OS.GUI.BaseApplication)).dependencies=["mde/simplemde.min"],this.OS.register("MarkOn",e)}).call(this);