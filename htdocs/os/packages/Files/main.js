(function(){var t,e={}.hasOwnProperty;t=function(t){function i(t){i.__super__.constructor.call(this,"Files",t)}return function(t,i){for(var n in i)e.call(i,n)&&(t[n]=i[n]);function r(){this.constructor=t}r.prototype=i.prototype,t.prototype=new r,t.__super__=i.prototype}(i,t),i.prototype.main=function(){var t,e,i,n,r;for(n=this,this.scheme.set("apptitle","Files manager"),this.view=this.find("fileview"),this.navinput=this.find("navinput"),this.navbar=this.find("nav-bar"),this.currdir=this.args&&this.args.length>0?this.args[0].asFileHandler():"home://".asFileHandler(),this.favo=this.find("favouri"),this.clipboard=void 0,this.viewType=this._api.switcher("icon","list","tree"),this.viewType.list=!0,this.apps=[],this.view.contextmenuHandler=function(t,e){return e.set("items",[n.mnFile(),n.mnEdit()]),e.set("onmenuselect",function(t){if(t.item.data.app)return n._gui.launch(t.item.data.app,t.item.data.args)}),e.show(t)},this.view.set("onfileopen",function(t){if(t&&"dir"!==t.type)return n._gui.openWith(t)}),this.favo.set("onlistselect",function(t){return n.chdir(t.data.path)}),$(this.find("btback")).click(function(){var t;if(!n.currdir.isRoot())return t=n.currdir.parent(),n.favo.set("selected",-1),n.chdir(t)}),$(this.navinput).keyup(function(t){if(13===t.keyCode)return n.chdir($(n.navinput).val())}),this.view.set("chdir",function(t){return n.chdir(t)}),this.view.set("fetch",function(t,e){if(t.child&&"[..]"!==t.child.filename)return t.child.path.asFileHandler().read(function(i){return i.error?n.error(__("Resource not found {0}",t.child.path)):e(i.result)})}),this.view.set("onfileselect",function(t){var e,i,r,a,s,o;if((e=n.view.get("selectedFile"))&&e.mime){for("dir"===e.type&&(e.mime="dir"),n.apps.length=0,s=[],i=0,r=(a=n._gui.appsByMime(e.mime)).length;i<r;i++)(o=a[i]).args=[e.path],s.push(n.apps.push(o));return s}}),void 0===this.setting.sidebar&&(this.setting.sidebar=!0),void 0===this.setting.nav&&(this.setting.nav=!0),void 0===this.setting.showhidden&&(this.setting.showhidden=!1),t=e=0,i=(r=this.systemsetting.VFS.mountpoints).length;e<i;t=++e)r[t].selected=!1;return this.favo.set("items",r),this.applySetting(),this.subscribe("VFS",function(t){if(t.data.file.hash()===n.currdir.hash()||t.data.file.parent().hash()===n.currdir.hash())return n.chdir(null)}),this.bindKey("CTRL-F",function(){return n.actionFile(n.name+"-mkf")}),this.bindKey("CTRL-D",function(){return n.actionFile(n.name+"-mkdir")}),this.bindKey("CTRL-U",function(){return n.actionFile(n.name+"-upload")}),this.bindKey("CTRL-S",function(){return n.actionFile(n.name+"-share")}),this.bindKey("CTRL-I",function(){return n.actionFile(n.name+"-info")}),this.bindKey("CTRL-R",function(){return n.actionEdit(n.name+"-mv")}),this.bindKey("CTRL-M",function(){return n.actionEdit(n.name+"-rm")}),this.bindKey("CTRL-X",function(){return n.actionEdit(n.name+"-cut")}),this.bindKey("CTRL-C",function(){return n.actionEdit(n.name+"-copy")}),this.bindKey("CTRL-P",function(){return n.actionEdit(n.name+"-paste")}),this.find("btgrid").set("onbtclick",function(t){return n.view.set("view","icon"),n.viewType.icon=!0}),this.find("btlist").set("onbtclick",function(t){return n.view.set("view","list"),n.viewType.list=!0}),this.chdir(null)},i.prototype.applySetting=function(t){return this.setting.view&&this.view.set("view",this.setting.view),this.view.set("showhidden",this.setting.showhidden),this.toggleSidebar(this.setting.sidebar),this.toggleNav(this.setting.nav)},i.prototype.chdir=function(t){var e,i;return i=this,(e=t?t.asFileHandler():i.currdir).read(function(n){return n.error?i.error(__("Resource not found {0}",t)):(i.currdir=e,e.isRoot()||((t=e.parent().asFileHandler()).filename="[..]",t.type="dir",n.result.unshift(t)),$(i.navinput).val(e.path),i.view.set("path",e.path),i.view.set("data",n.result))})},i.prototype.mnFile=function(){var t;return t=this,{text:"__(File)",child:[{text:"__(New file)",dataid:this.name+"-mkf",shortcut:"C-F"},{text:"__(New folder)",dataid:this.name+"-mkdir",shortcut:"C-D"},{text:"__(Open with)",dataid:this.name+"-open",child:this.apps},{text:"__(Upload)",dataid:this.name+"-upload",shortcut:"C-U"},{text:"__(Download)",dataid:this.name+"-download"},{text:"__(Share file)",dataid:this.name+"-share",shortcut:"C-S"},{text:"__(Properties)",dataid:this.name+"-info",shortcut:"C-I"}],onmenuselect:function(e){return t.actionFile(e.item.data.dataid)}}},i.prototype.mnEdit=function(){var t;return t=this,{text:"__(Edit)",child:[{text:"__(Rename)",dataid:this.name+"-mv",shortcut:"C-R"},{text:"__(Delete)",dataid:this.name+"-rm",shortcut:"C-M"},{text:"__(Cut)",dataid:this.name+"-cut",shortcut:"C-X"},{text:"__(Copy)",dataid:this.name+"-copy",shortcut:"C-C"},{text:"__(Paste)",dataid:this.name+"-paste",shortcut:"C-P"}],onmenuselect:function(e){return t.actionEdit(e.item.data.dataid)}}},i.prototype.menu=function(){var t;return t=this,[this.mnFile(),this.mnEdit(),{text:"__(View)",child:[{text:"__(Refresh)",dataid:this.name+"-refresh"},{text:"__(Sidebar)",switch:!0,checked:this.setting.sidebar,dataid:this.name+"-side"},{text:"__(Navigation bar)",switch:!0,checked:this.setting.nav,dataid:this.name+"-nav"},{text:"__(Hidden files)",switch:!0,checked:this.setting.showhidden,dataid:this.name+"-hidden"},{text:"__(Type)",child:[{text:"__(Icon view)",radio:!0,checked:function(){return t.viewType.icon},dataid:this.name+"-icon",type:"icon"},{text:"__(List view)",radio:!0,checked:function(){return t.viewType.list},dataid:this.name+"-list",type:"list"},{text:"__(Tree view)",radio:!0,checked:function(){return t.viewType.tree},dataid:this.name+"-tree",type:"tree"}],onmenuselect:function(e){return t.view.set("view",e.item.data.type),t.viewType[e.item.data.type]=!0}}],onmenuselect:function(e){return t.actionView(e)}}]},i.prototype.toggleSidebar=function(t){return t?$(this.favo).show():$(this.favo).hide(),this.trigger("resize")},i.prototype.toggleNav=function(t){return t?$(this.navbar).show():$(this.navbar).hide(),this.trigger("resize")},i.prototype.actionView=function(t){switch(t.item.data.dataid){case this.name+"-hidden":return this.registry("showhidden",t.item.data.checked);case this.name+"-refresh":return this.chdir(null);case this.name+"-side":return this.registry("sidebar",t.item.data.checked);case this.name+"-nav":return this.registry("nav",t.item.data.checked)}},i.prototype.actionEdit=function(t){var e,i;switch(i=this,e=this.view.get("selectedFile"),t){case this.name+"-mv":if(!e)return;return this.openDialog("PromptDialog",function(t){if(t!==e.filename)return e.path.asFileHandler().move(i.currdir.path+"/"+t,function(e){if(e.error)return i.error(__("Fail to rename to {0}: {1}",t,e.error))})},"__(Rename)",{label:"__(File name)",value:e.filename});case this.name+"-rm":if(!e)return;return this.openDialog("YesNoDialog",function(t){if(t)return e.path.asFileHandler().remove(function(t){if(t.error)return i.error(__("Fail to delete {0}: {1}",e.filename,t.error))})},"__(Delete)",{iconclass:"fa fa-question-circle",text:__("Do you really want to delete: {0}?",e.filename)});case this.name+"-cut":if(!e)return;return this.clipboard={cut:!0,file:e.path.asFileHandler()},this.notify(__("File {0} cut",e.filename));case this.name+"-copy":if(!e)return;return this.clipboard={cut:!1,file:e.path.asFileHandler()},this.notify(__("File {0} copied",e.filename));case this.name+"-paste":if(i=this,!this.clipboard)return;return this.clipboard.cut?this.clipboard.file.move(i.currdir.path+"/"+this.clipboard.file.basename,function(t){if(i.clipboard=void 0,t.error)return i.error(__("Fail to paste: {0}",t.error))}):(this.notify(__("Copy not yet implemented")),this.clipboard=void 0);default:return this._api.handler.setting()}},i.prototype.actionFile=function(t){var e,i;switch(i=this,e=this.view.get("selectedFile"),t){case this.name+"-mkdir":return this.openDialog("PromptDialog",function(t){return i.currdir.mk(t,function(e){if(e.error)return i.error(__("Fail to create {0}: {1}",t,e.error))})},"__(New folder)",{label:"__(Folder name)"});case this.name+"-mkf":return this.openDialog("PromptDialog",function(t){return(i.currdir.path+"/"+t).asFileHandler().write("text/plain",function(e){if(e.error)return i.error(__("Fail to create {0}: {1}",t,e.error))})},"__(New file)",{label:"__(File name)"});case this.name+"-info":if(!e)return;return this.openDialog("InfoDialog",null,e.filename,e);case this.name+"-upload":return i=this,this.currdir.upload(function(t){if(t.error)return i.error(__("Fail to upload to {0}: {1}",d,t.error))});case this.name+"-share":if(i=this,!e||"file"!==e.type)return;return e.path.asFileHandler().publish(function(t){return t.error?i.error(__("Cannot share file: {0}",t.error)):i.notify(__("Shared url: {0}",t.result))});case this.name+"-download":if(!e)return;return e.path.asFileHandler().download(function(){});default:return console.log(t)}},i}(this.OS.GUI.BaseApplication),this.OS.register("Files",t)}).call(this);