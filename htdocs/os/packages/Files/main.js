(function(){var t,n={}.hasOwnProperty;t=function(t){function e(t){e.__super__.constructor.call(this,"Files",t)}return function(t,e){for(var i in e)n.call(e,i)&&(t[i]=e[i]);function r(){this.constructor=t}r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype}(e,t),e.prototype.main=function(){var t,e,i,o,r;for((o=this).scheme.set("apptitle","Files manager"),this.view=this.find("fileview"),this.navinput=this.find("navinput"),this.navbar=this.find("nav-bar"),this.currdir=this.args&&0<this.args.length?this.args[0].asFileHandler():"home://".asFileHandler(),this.favo=this.find("favouri"),this.clipboard=void 0,this.viewType=this._api.switcher("icon","list","tree"),this.viewType.list=!0,this.apps=[],this.view.contextmenuHandler=function(t,e){return e.set("items",[o.mnFile(),o.mnEdit()]),e.set("onmenuselect",function(t){if(t.item.data.app)return o._gui.launch(t.item.data.app,t.item.data.args)}),e.show(t)},this.view.set("onfileopen",function(t){if(t&&"dir"!==t.type)return o._gui.openWith(t)}),this.favo.set("onlistselect",function(t){return o.chdir(t.data.path)}),$(this.find("btback")).click(function(){var t;if(!o.currdir.isRoot())return t=o.currdir.parent(),o.favo.set("selected",-1),o.chdir(t)}),$(this.navinput).keyup(function(t){if(13===t.keyCode)return o.chdir($(o.navinput).val())}),this.view.set("chdir",function(t){return o.chdir(t)}),this.view.set("fetch",function(e,i){if(e.child&&"[..]"!==e.child.filename)return e.child.path.asFileHandler().read(function(t){return t.error?o.error(__("Resource not found {0}",e.child.path)):i(t.result)})}),this.view.set("onfileselect",function(t){var e,i,r,n,a,s;if((e=o.view.get("selectedFile"))&&e.mime){for("dir"===e.type&&(e.mime="dir"),a=[],i=o.apps.length=0,r=(n=o._gui.appsByMime(e.mime)).length;i<r;i++)(s=n[i]).args=[e.path],a.push(o.apps.push(s));return a}}),void 0===this.setting.sidebar&&(this.setting.sidebar=!0),void 0===this.setting.nav&&(this.setting.nav=!0),void 0===this.setting.showhidden&&(this.setting.showhidden=!1),t=e=0,i=(r=this.systemsetting.VFS.mountpoints).length;e<i;t=++e)r[t].selected=!1;return this.favo.set("items",r),this.applySetting(),this.setting.view&&this.view.set("view",this.setting.view),this.subscribe("VFS",function(t){if(t.data.file.hash()===o.currdir.hash()||t.data.file.parent().hash()===o.currdir.hash())return o.chdir(null)}),this.bindKey("CTRL-F",function(){return o.actionFile(o.name+"-mkf")}),this.bindKey("CTRL-D",function(){return o.actionFile(o.name+"-mkdir")}),this.bindKey("CTRL-U",function(){return o.actionFile(o.name+"-upload")}),this.bindKey("CTRL-S",function(){return o.actionFile(o.name+"-share")}),this.bindKey("CTRL-I",function(){return o.actionFile(o.name+"-info")}),this.bindKey("CTRL-R",function(){return o.actionEdit(o.name+"-mv")}),this.bindKey("CTRL-M",function(){return o.actionEdit(o.name+"-rm")}),this.bindKey("CTRL-X",function(){return o.actionEdit(o.name+"-cut")}),this.bindKey("CTRL-C",function(){return o.actionEdit(o.name+"-copy")}),this.bindKey("CTRL-P",function(){return o.actionEdit(o.name+"-paste")}),this.find("btgrid").set("onbtclick",function(t){return o.view.set("view","icon"),o.viewType.icon=!0}),this.find("btlist").set("onbtclick",function(t){return o.view.set("view","list"),o.viewType.list=!0}),this.chdir(null)},e.prototype.applySetting=function(t){switch(t){case"showhidden":return this.view.set("showhidden",this.setting.showhidden);case"nav":return this.toggleNav(this.setting.nav);case"sidebar":return this.toggleSidebar(this.setting.sidebar)}},e.prototype.chdir=function(e){var i,r;return r=this,(i=e?e.asFileHandler():r.currdir).read(function(t){return t.error?r.error(__("Resource not found {0}",e)):((r.currdir=i).isRoot()||((e=i.parent().asFileHandler()).filename="[..]",e.type="dir",t.result.unshift(e)),$(r.navinput).val(i.path),r.view.set("path",i.path),r.view.set("data",t.result))})},e.prototype.mnFile=function(){var e;return{text:"__(File)",child:[{text:"__(New file)",dataid:(e=this).name+"-mkf",shortcut:"C-F"},{text:"__(New folder)",dataid:this.name+"-mkdir",shortcut:"C-D"},{text:"__(Open with)",dataid:this.name+"-open",child:this.apps},{text:"__(Upload)",dataid:this.name+"-upload",shortcut:"C-U"},{text:"__(Download)",dataid:this.name+"-download"},{text:"__(Share file)",dataid:this.name+"-share",shortcut:"C-S"},{text:"__(Properties)",dataid:this.name+"-info",shortcut:"C-I"}],onmenuselect:function(t){return e.actionFile(t.item.data.dataid)}}},e.prototype.mnEdit=function(){var e;return{text:"__(Edit)",child:[{text:"__(Rename)",dataid:(e=this).name+"-mv",shortcut:"C-R"},{text:"__(Delete)",dataid:this.name+"-rm",shortcut:"C-M"},{text:"__(Cut)",dataid:this.name+"-cut",shortcut:"C-X"},{text:"__(Copy)",dataid:this.name+"-copy",shortcut:"C-C"},{text:"__(Paste)",dataid:this.name+"-paste",shortcut:"C-P"}],onmenuselect:function(t){return e.actionEdit(t.item.data.dataid)}}},e.prototype.menu=function(){var e;return[(e=this).mnFile(),this.mnEdit(),{text:"__(View)",child:[{text:"__(Refresh)",dataid:this.name+"-refresh"},{text:"__(Sidebar)",switch:!0,checked:this.setting.sidebar,dataid:this.name+"-side"},{text:"__(Navigation bar)",switch:!0,checked:this.setting.nav,dataid:this.name+"-nav"},{text:"__(Hidden files)",switch:!0,checked:this.setting.showhidden,dataid:this.name+"-hidden"},{text:"__(Type)",child:[{text:"__(Icon view)",radio:!0,checked:function(){return e.viewType.icon},dataid:this.name+"-icon",type:"icon"},{text:"__(List view)",radio:!0,checked:function(){return e.viewType.list},dataid:this.name+"-list",type:"list"},{text:"__(Tree view)",radio:!0,checked:function(){return e.viewType.tree},dataid:this.name+"-tree",type:"tree"}],onmenuselect:function(t){return e.view.set("view",t.item.data.type),e.viewType[t.item.data.type]=!0}}],onmenuselect:function(t){return e.actionView(t)}}]},e.prototype.toggleSidebar=function(t){return t?$(this.favo).show():$(this.favo).hide(),this.trigger("resize")},e.prototype.toggleNav=function(t){return t?$(this.navbar).show():$(this.navbar).hide(),this.trigger("resize")},e.prototype.actionView=function(t){switch(t.item.data.dataid){case this.name+"-hidden":return this.registry("showhidden",t.item.data.checked);case this.name+"-refresh":return this.chdir(null);case this.name+"-side":return this.registry("sidebar",t.item.data.checked);case this.name+"-nav":return this.registry("nav",t.item.data.checked)}},e.prototype.actionEdit=function(t){var i,r;switch(i=(r=this).view.get("selectedFile"),t){case this.name+"-mv":if(!i)return;return this.openDialog("PromptDialog",function(e){if(e!==i.filename)return i.path.asFileHandler().move(r.currdir.path+"/"+e,function(t){if(t.error)return r.error(__("Fail to rename to {0}: {1}",e,t.error))})},"__(Rename)",{label:"__(File name)",value:i.filename});case this.name+"-rm":if(!i)return;return this.openDialog("YesNoDialog",function(t){if(t)return i.path.asFileHandler().remove(function(t){if(t.error)return r.error(__("Fail to delete {0}: {1}",i.filename,t.error))})},"__(Delete)",{iconclass:"fa fa-question-circle",text:__("Do you really want to delete: {0}?",i.filename)});case this.name+"-cut":if(!i)return;return this.clipboard={cut:!0,file:i.path.asFileHandler()},this.notify(__("File {0} cut",i.filename));case this.name+"-copy":if(!i&&"dir"!==i.type)return;return this.clipboard={cut:!1,file:i.path.asFileHandler()},this.notify(__("File {0} copied",i.filename));case this.name+"-paste":if(!(r=this).clipboard)return;return this.clipboard.cut?this.clipboard.file.move(r.currdir.path+"/"+this.clipboard.file.basename,function(t){if(r.clipboard=void 0,t.error)return r.error(__("Fail to paste: {0}",t.error))}):this.clipboard.file.read(function(t){var e,i;return e=new Blob([t],{type:r.clipboard.file.info.mime}),(i=(r.currdir.path+"/"+r.clipboard.file.basename).asFileHandler()).cache=e,i.write(r.clipboard.file.info.mime,function(t){if(r.clipboard=void 0,t.error)return r.error(__("Fail to paste: {0}",t.error))})},"binary");default:return this._api.handler.setting()}},e.prototype.actionFile=function(t){var e,i;switch(e=(i=this).view.get("selectedFile"),t){case this.name+"-mkdir":return this.openDialog("PromptDialog",function(e){return i.currdir.mk(e,function(t){if(t.error)return i.error(__("Fail to create {0}: {1}",e,t.error))})},"__(New folder)",{label:"__(Folder name)"});case this.name+"-mkf":return this.openDialog("PromptDialog",function(e){return(i.currdir.path+"/"+e).asFileHandler().write("text/plain",function(t){if(t.error)return i.error(__("Fail to create {0}: {1}",e,t.error))})},"__(New file)",{label:"__(File name)"});case this.name+"-info":if(!e)return;return this.openDialog("InfoDialog",null,e.filename,e);case this.name+"-upload":return(i=this).currdir.upload(function(t){if(t.error)return i.error(__("Fail to upload to {0}: {1}",i.currdir.path,t.error))});case this.name+"-share":if(i=this,!e||"file"!==e.type)return;return e.path.asFileHandler().publish(function(t){return t.error?i.error(__("Cannot share file: {0}",t.error)):i.notify(__("Shared url: {0}",t.result))});case this.name+"-download":if(!e)return;return e.path.asFileHandler().download(function(){});default:return console.log(t)}},e}(this.OS.GUI.BaseApplication),this.OS.register("Files",t)}).call(this);